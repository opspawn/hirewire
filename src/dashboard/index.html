<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HireWire Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
  :root {
    --bg: #09090b;
    --bg-secondary: #18181b;
    --card: #1c1c22;
    --card-hover: #232329;
    --border: #27272a;
    --border-active: #3f3f46;
    --accent: #6366f1;
    --accent-light: #818cf8;
    --accent-glow: rgba(99,102,241,0.15);
    --green: #22c55e;
    --green-dim: rgba(34,197,94,0.15);
    --yellow: #eab308;
    --yellow-dim: rgba(234,179,8,0.15);
    --red: #ef4444;
    --red-dim: rgba(239,68,68,0.15);
    --blue: #3b82f6;
    --blue-dim: rgba(59,130,246,0.15);
    --cyan: #06b6d4;
    --cyan-dim: rgba(6,182,212,0.15);
    --purple: #a855f7;
    --purple-dim: rgba(168,85,247,0.15);
    --text: #fafafa;
    --text-secondary: #a1a1aa;
    --text-muted: #71717a;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg); color: var(--text);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    font-size: 14px; line-height: 1.5; min-height: 100vh; overflow: hidden;
  }
  .app-layout { display: flex; height: 100vh; }
  .sidebar {
    width: 220px; min-width: 220px; background: var(--bg-secondary);
    border-right: 1px solid var(--border); display: flex; flex-direction: column; height: 100vh; z-index: 10;
  }
  .sidebar-logo { padding: 18px 16px 14px; border-bottom: 1px solid var(--border); }
  .sidebar-logo h1 { font-size: 18px; font-weight: 800; color: var(--text); letter-spacing: -0.03em; display: flex; align-items: center; gap: 8px; }
  .sidebar-logo h1 span { color: var(--accent-light); }
  .sidebar-logo .version { font-size: 10px; color: var(--text-muted); margin-top: 2px; letter-spacing: 0.02em; }
  .sidebar-nav { flex: 1; padding: 6px; overflow-y: auto; }
  .nav-section { margin-bottom: 2px; }
  .nav-section-label { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); padding: 10px 10px 4px; }
  .nav-item { display: flex; align-items: center; gap: 8px; padding: 7px 10px; border-radius: 6px; cursor: pointer; color: var(--text-secondary); font-size: 12px; font-weight: 500; transition: all 0.15s ease; margin-bottom: 1px; user-select: none; }
  .nav-item:hover { background: var(--card); color: var(--text); }
  .nav-item.active { background: var(--accent-glow); color: var(--accent-light); }
  .nav-item svg { width: 16px; height: 16px; flex-shrink: 0; opacity: 0.7; }
  .nav-item.active svg { opacity: 1; }
  .nav-badge { margin-left: auto; font-size: 9px; font-weight: 700; padding: 1px 5px; border-radius: 10px; background: var(--accent-glow); color: var(--accent-light); }
  .sidebar-footer { padding: 10px 14px; border-top: 1px solid var(--border); }
  .system-status { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-secondary); }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
  .status-dot.offline { background: var(--red); }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
  @keyframes spin { to { transform: rotate(360deg); } }
  .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
  .top-bar { display: flex; align-items: center; justify-content: space-between; padding: 10px 20px; border-bottom: 1px solid var(--border); background: var(--bg); min-height: 48px; }
  .top-bar-left { display: flex; align-items: center; gap: 10px; }
  .page-title { font-size: 15px; font-weight: 700; letter-spacing: -0.02em; }
  .top-bar-right { display: flex; align-items: center; gap: 8px; }
  .gpt4o-badge { font-size: 9px; font-weight: 700; padding: 3px 8px; border-radius: 10px; background: var(--green-dim); color: var(--green); text-transform: uppercase; letter-spacing: 0.05em; display: none; }
  .gpt4o-badge.active { display: inline-block; }
  .demo-badge { font-size: 9px; font-weight: 700; padding: 3px 8px; border-radius: 10px; background: var(--yellow-dim); color: var(--yellow); text-transform: uppercase; letter-spacing: 0.05em; display: none; }
  .demo-badge.active { display: inline-block; }
  .azure-badge { font-size: 9px; font-weight: 700; padding: 3px 8px; border-radius: 10px; background: var(--blue-dim); color: var(--blue); text-transform: uppercase; letter-spacing: 0.05em; }
  .btn { display: inline-flex; align-items: center; gap: 5px; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; font-family: inherit; cursor: pointer; border: 1px solid var(--border); background: var(--card); color: var(--text); transition: all 0.15s ease; }
  .btn:hover { background: var(--card-hover); border-color: var(--border-active); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-primary { background: var(--accent); border-color: var(--accent); color: white; }
  .btn-primary:hover { background: var(--accent-light); border-color: var(--accent-light); }
  .btn-sm { padding: 4px 8px; font-size: 11px; }
  .btn-success { background: var(--green); border-color: var(--green); }
  .btn-success:hover { background: #16a34a; border-color: #16a34a; }
  .page-area { flex: 1; overflow-y: auto; padding: 20px; scroll-behavior: smooth; }
  .page { display: none; }
  .page.active { display: block; }
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; transition: border-color 0.15s ease; }
  .card:hover { border-color: var(--border-active); }
  .card-header { padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .card-title { font-size: 12px; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 6px; }
  .card-body { padding: 16px; }
  .card-body-flush { padding: 0; }
  .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 18px; }
  .stat-card { background: linear-gradient(135deg, var(--card) 0%, rgba(99,102,241,0.04) 100%); border: 1px solid var(--border); border-radius: 12px; padding: 18px 20px; transition: border-color 0.15s ease; position: relative; overflow: hidden; }
  .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--accent), transparent); opacity: 0; transition: opacity 0.3s; }
  .stat-card:hover { border-color: var(--border-active); }
  .stat-card:hover::before { opacity: 1; }
  .stat-label { font-size: 11px; color: var(--text-muted); font-weight: 600; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.04em; }
  .stat-value { font-size: 30px; font-weight: 800; color: var(--text); letter-spacing: -0.03em; line-height: 1.1; }
  .stat-value.accent { color: var(--accent-light); }
  .stat-value.green { color: var(--green); }
  .stat-change { font-size: 10px; font-weight: 500; margin-top: 5px; color: var(--text-muted); }
  .stat-change.up { color: var(--green); }
  .stat-change.down { color: var(--red); }
  .data-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .data-table th { text-align: left; padding: 8px 12px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.2); }
  .data-table td { padding: 8px 12px; border-bottom: 1px solid var(--border); color: var(--text-secondary); }
  .data-table tr:last-child td { border-bottom: none; }
  .data-table tr:hover td { background: rgba(255,255,255,0.02); }
  .badge { display: inline-flex; align-items: center; padding: 2px 7px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.03em; }
  .badge-green { background: var(--green-dim); color: var(--green); }
  .badge-yellow { background: var(--yellow-dim); color: var(--yellow); }
  .badge-red { background: var(--red-dim); color: var(--red); }
  .badge-blue { background: var(--blue-dim); color: var(--blue); }
  .badge-cyan { background: var(--cyan-dim); color: var(--cyan); }
  .badge-purple { background: var(--purple-dim); color: var(--purple); }
  .badge-muted { background: rgba(113,113,122,0.15); color: var(--text-muted); }
  .tag { display: inline-block; padding: 3px 8px; border-radius: 20px; font-size: 10px; font-weight: 600; background: var(--bg); color: var(--text-secondary); border: 1px solid var(--border); margin-right: 4px; margin-bottom: 4px; transition: all 0.15s; }
  .tag:hover { border-color: var(--border-active); transform: translateY(-1px); }
  .tag-accent { background: var(--accent-glow); color: var(--accent-light); border-color: transparent; }
  .tag-blue { background: var(--blue-dim); color: var(--blue); border-color: transparent; }
  .tag-green { background: var(--green-dim); color: var(--green); border-color: transparent; }
  .tag-yellow { background: var(--yellow-dim); color: var(--yellow); border-color: transparent; }
  .tag-purple { background: var(--purple-dim); color: var(--purple); border-color: transparent; }
  .tag-cyan { background: var(--cyan-dim); color: var(--cyan); border-color: transparent; }
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
  .col-span-2 { grid-column: span 2; }
  .activity-item { display: flex; align-items: flex-start; gap: 10px; padding: 10px 12px; margin: 0 -12px; border-bottom: 1px solid var(--border); border-radius: 6px; transition: background 0.15s; }
  .activity-item:hover { background: rgba(255,255,255,0.02); }
  .activity-item:last-child { border-bottom: none; }
  .activity-icon { width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 13px; font-weight: 700; }
  .activity-icon.green { background: var(--green-dim); color: var(--green); }
  .activity-icon.blue { background: var(--blue-dim); color: var(--blue); }
  .activity-icon.yellow { background: var(--yellow-dim); color: var(--yellow); }
  .activity-icon.accent { background: var(--accent-glow); color: var(--accent-light); }
  .activity-text { flex: 1; font-size: 12px; color: var(--text-secondary); line-height: 1.5; }
  .activity-text strong { color: var(--text); font-weight: 600; }
  .activity-time { font-size: 10px; color: var(--text-muted); white-space: nowrap; flex-shrink: 0; font-variant-numeric: tabular-nums; background: var(--bg); padding: 2px 6px; border-radius: 4px; }
  .agent-row { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-bottom: 1px solid var(--border); cursor: pointer; transition: all 0.15s ease; }
  .agent-row:last-child { border-bottom: none; }
  .agent-row:hover { background: rgba(255,255,255,0.03); }
  .agent-row.selected { background: var(--accent-glow); border-left: 3px solid var(--accent-light); }
  .agent-avatar { width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 15px; font-weight: 700; flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
  .agent-info { flex: 1; min-width: 0; }
  .agent-name { font-weight: 600; font-size: 13px; color: var(--text); display: flex; align-items: center; gap: 6px; }
  .agent-desc { font-size: 11px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .agent-stats { display: flex; gap: 14px; flex-shrink: 0; }
  .agent-stat-item { text-align: right; }
  .agent-stat-value { font-size: 13px; font-weight: 700; color: var(--text); }
  .agent-stat-label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
  .detail-panel { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 10px; padding: 16px; }
  .detail-section { margin-bottom: 14px; }
  .detail-section-title { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: 6px; }
  .detail-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 12px; border-bottom: 1px solid var(--border); }
  .detail-row:last-child { border-bottom: none; }
  .detail-row .label { color: var(--text-muted); }
  .detail-row .value { color: var(--text); font-weight: 500; }
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 100; backdrop-filter: blur(4px); }
  .modal-overlay.active { display: flex; }
  .modal { background: var(--card); border: 1px solid var(--border); border-radius: 12px; width: 480px; max-width: 90vw; max-height: 80vh; overflow-y: auto; }
  .modal-header { padding: 16px 18px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .modal-title { font-size: 14px; font-weight: 600; }
  .modal-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; padding: 4px; }
  .modal-close:hover { color: var(--text); }
  .modal-body { padding: 16px; }
  .modal-footer { padding: 12px 18px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }
  .form-group { margin-bottom: 14px; }
  .form-label { display: block; font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.04em; }
  .form-input { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 9px 12px; color: var(--text); font-family: inherit; font-size: 12px; outline: none; transition: all 0.2s; }
  .form-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
  .form-input::placeholder { color: var(--text-muted); }
  .form-input:hover { border-color: var(--border-active); }
  .chart-container { position: relative; height: 200px; width: 100%; }
  .empty-state { text-align: center; padding: 30px 16px; color: var(--text-muted); font-size: 12px; }
  .response-preview { font-size: 11px; color: var(--text-muted); background: var(--bg); border: 1px solid var(--border); border-radius: 5px; padding: 6px 10px; margin-top: 4px; line-height: 1.4; max-height: 70px; overflow: hidden; }
  .gpt4o-tag { display: inline-block; padding: 1px 5px; border-radius: 3px; font-size: 8px; font-weight: 700; background: var(--green-dim); color: var(--green); letter-spacing: 0.05em; margin-left: 4px; }
  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--border-active); }
  .toast-container { position: fixed; bottom: 16px; right: 16px; z-index: 200; display: flex; flex-direction: column; gap: 6px; }
  .toast { padding: 8px 14px; background: var(--card); border: 1px solid var(--border); border-radius: 8px; font-size: 12px; color: var(--text-secondary); box-shadow: 0 8px 24px rgba(0,0,0,0.4); animation: slideIn 0.3s ease; }
  .toast.success { border-left: 3px solid var(--green); }
  .toast.error { border-left: 3px solid var(--red); }
  .toast.info { border-left: 3px solid var(--accent); }
  @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
  .page { animation: fadeIn 0.25s ease-out; }
  .stat-card { transition: border-color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease; }
  .stat-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
  .card { transition: border-color 0.2s ease, box-shadow 0.2s ease; }
  .card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
  .loading-skeleton { background: linear-gradient(90deg, var(--card) 25%, var(--card-hover) 50%, var(--card) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 6px; height: 20px; }
  .loading-skeleton.lg { height: 32px; width: 60px; }
  .loading-skeleton.bar { height: 12px; width: 100%; margin-bottom: 8px; }
  .nav-item { transition: all 0.2s ease; }
  .kanban-card { transition: border-color 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease; }
  .kanban-card:hover { transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.2); }
  .gauge-bar-fill { transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }
  .badge { transition: all 0.2s ease; }
  /* Category filter pills */
  .filter-pill { display: inline-flex; align-items: center; padding: 3px 10px; border-radius: 20px; font-size: 10px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: transparent; color: var(--text-muted); transition: all 0.15s; user-select: none; }
  .filter-pill:hover { border-color: var(--border-active); color: var(--text-secondary); }
  .filter-pill.active { background: var(--accent-glow); border-color: var(--accent); color: var(--accent-light); }
  .filter-pill.active-green { background: var(--green-dim); border-color: var(--green); color: var(--green); }
  .filter-pill.active-yellow { background: var(--yellow-dim); border-color: var(--yellow); color: var(--yellow); }
  .filter-pill.active-purple { background: var(--purple-dim); border-color: var(--purple); color: var(--purple); }
  /* Success/error states for forms */
  .form-success { border-color: var(--green) !important; box-shadow: 0 0 0 3px var(--green-dim) !important; }
  .form-error { border-color: var(--red) !important; box-shadow: 0 0 0 3px var(--red-dim) !important; }
  .form-hint { font-size: 10px; color: var(--text-muted); margin-top: 4px; }
  .form-hint.error { color: var(--red); }
  .form-hint.success { color: var(--green); }
  /* Step indicator */
  .step-indicator { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }
  .step-dot { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; border: 2px solid var(--border); color: var(--text-muted); transition: all 0.3s; }
  .step-dot.active { border-color: var(--accent); color: var(--accent-light); background: var(--accent-glow); }
  .step-dot.done { border-color: var(--green); color: var(--green); background: var(--green-dim); }
  .step-line { flex: 1; height: 2px; background: var(--border); transition: background 0.3s; }
  .step-line.done { background: var(--green); }
  .azure-footer { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 8px 16px; background: var(--bg-secondary); border-top: 1px solid var(--border); font-size: 10px; color: var(--text-muted); letter-spacing: 0.03em; flex-shrink: 0; }
  .azure-footer .footer-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
  .azure-footer .footer-badge.azure { background: var(--blue-dim); color: var(--blue); }
  .azure-footer .footer-badge.cosmos { background: var(--purple-dim); color: var(--purple); }
  .azure-footer .footer-badge.framework { background: var(--accent-glow); color: var(--accent-light); }
  /* Orchestration view */
  .orch-flow { display: flex; align-items: center; justify-content: center; gap: 0; padding: 20px 10px; overflow-x: auto; }
  .orch-node { display: flex; flex-direction: column; align-items: center; gap: 6px; min-width: 100px; }
  .orch-node-box { width: 84px; height: 84px; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid var(--border); transition: all 0.3s; position: relative; background: var(--bg-secondary); }
  .orch-node-box.active { border-color: var(--green); box-shadow: 0 0 24px rgba(34,197,94,0.25); background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(34,197,94,0.08) 100%); }
  .orch-node-box.idle { border-color: var(--border); }
  .orch-node-box .icon { font-size: 22px; margin-bottom: 3px; }
  .orch-node-box .name { font-size: 9px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.06em; }
  .orch-node-status { font-size: 9px; font-weight: 600; padding: 2px 8px; border-radius: 8px; }
  .orch-arrow { width: 40px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); font-size: 18px; margin-top: -20px; }
  .orch-arrow.active { color: var(--green); }
  /* Pipeline kanban */
  .kanban { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
  .kanban-col { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; min-height: 200px; }
  .kanban-header { padding: 10px 12px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .kanban-header-title { font-size: 11px; font-weight: 600; color: var(--text); }
  .kanban-header-count { font-size: 10px; font-weight: 600; padding: 1px 6px; border-radius: 8px; background: var(--accent-glow); color: var(--accent-light); }
  .kanban-body { padding: 8px; display: flex; flex-direction: column; gap: 6px; }
  .kanban-card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; font-size: 11px; color: var(--text-secondary); transition: all 0.15s; cursor: pointer; }
  .kanban-card:hover { border-color: var(--accent); background: var(--card-hover); }
  .kanban-card-title { font-weight: 600; color: var(--text); margin-bottom: 4px; font-size: 11px; line-height: 1.4; }
  .kanban-card-meta { font-size: 9px; color: var(--text-muted); display: flex; gap: 8px; margin-top: 5px; align-items: center; }
  /* Ledger */
  .ledger-summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 14px; }
  .ledger-item { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-align: center; }
  .ledger-item-label { font-size: 10px; color: var(--text-muted); font-weight: 500; }
  .ledger-item-value { font-size: 20px; font-weight: 700; margin-top: 2px; }
  /* RAI gauges */
  .gauge-row { display: flex; gap: 10px; margin-bottom: 12px; }
  .gauge { flex: 1; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-align: center; }
  .gauge-value { font-size: 24px; font-weight: 800; line-height: 1; }
  .gauge-label { font-size: 10px; color: var(--text-muted); margin-top: 4px; font-weight: 500; }
  .gauge-bar { height: 4px; background: var(--border); border-radius: 2px; margin-top: 8px; overflow: hidden; }
  .gauge-bar-fill { height: 100%; border-radius: 2px; transition: width 0.5s ease; }
  /* Pipeline overlay */
  .pipeline-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.75); display: none; align-items: center; justify-content: center; z-index: 150; backdrop-filter: blur(6px); }
  .pipeline-overlay.active { display: flex; }
  .pipeline-panel { background: var(--card); border: 1px solid var(--border); border-radius: 14px; width: 600px; max-width: 92vw; max-height: 85vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }
  .pipeline-header { padding: 16px 20px 14px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .pipeline-header h2 { font-size: 15px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 8px; }
  .pipeline-header .live-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); animation: pulse 1.5s infinite; }
  .pipeline-body { padding: 16px 20px; }
  .pipeline-task { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; margin-bottom: 16px; }
  .pipeline-task-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: 3px; }
  .pipeline-task-text { font-size: 13px; color: var(--text); font-weight: 500; line-height: 1.4; }
  .pipeline-stages { display: flex; flex-direction: column; gap: 0; }
  .pipeline-stage { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; position: relative; }
  .pipeline-stage-line { position: absolute; left: 13px; top: 32px; bottom: -10px; width: 2px; background: var(--border); }
  .pipeline-stage:last-child .pipeline-stage-line { display: none; }
  .pipeline-stage-dot { width: 30px; height: 30px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 11px; font-weight: 700; transition: all 0.4s ease; z-index: 1; background: var(--bg); }
  .pipeline-stage.waiting .pipeline-stage-dot { border-color: var(--border); color: var(--text-muted); }
  .pipeline-stage.active .pipeline-stage-dot { border-color: var(--accent); color: var(--accent-light); background: var(--accent-glow); animation: pulse 1s infinite; }
  .pipeline-stage.done .pipeline-stage-dot { border-color: var(--green); color: var(--green); background: var(--green-dim); }
  .pipeline-stage.done .pipeline-stage-line { background: var(--green); }
  .pipeline-stage-content { flex: 1; min-width: 0; }
  .pipeline-stage-name { font-size: 12px; font-weight: 600; color: var(--text-muted); transition: color 0.3s; }
  .pipeline-stage.active .pipeline-stage-name, .pipeline-stage.done .pipeline-stage-name { color: var(--text); }
  .pipeline-stage-detail { font-size: 11px; color: var(--text-muted); margin-top: 2px; line-height: 1.4; opacity: 0; transition: opacity 0.4s; }
  .pipeline-stage.active .pipeline-stage-detail, .pipeline-stage.done .pipeline-stage-detail { opacity: 1; }
  .pipeline-stage-time { font-size: 10px; color: var(--text-muted); flex-shrink: 0; opacity: 0; transition: opacity 0.3s; }
  .pipeline-stage.done .pipeline-stage-time { opacity: 1; color: var(--green); }
  .pipeline-result { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; margin-top: 14px; display: none; }
  .pipeline-result.visible { display: block; animation: slideIn 0.3s ease; }
  .pipeline-result-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; }
  .pipeline-result-title { font-size: 12px; font-weight: 600; color: var(--green); }
  .pipeline-result-stats { display: flex; gap: 14px; }
  .pipeline-result-stat { text-align: center; }
  .pipeline-result-stat-value { font-size: 14px; font-weight: 700; color: var(--text); }
  .pipeline-result-stat-label { font-size: 9px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
  .pipeline-result-preview { font-size: 11px; color: var(--text-secondary); line-height: 1.5; margin-top: 8px; background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 8px 10px; max-height: 100px; overflow-y: auto; }
  .pipeline-footer { padding: 12px 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  .pipeline-total { font-size: 12px; color: var(--text-muted); }
  .pipeline-total strong { color: var(--text); }
</style>
</head>
<body>
<div class="app-layout">
  <aside class="sidebar">
    <div class="sidebar-logo">
      <h1><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M8 12l2 2 4-4"/></svg>Hire<span>Wire</span></h1>
      <div class="version">v0.15.0 &middot; Microsoft AI Dev Days 2026</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-label">Platform</div>
        <div class="nav-item active" data-page="overview" onclick="navigateTo('overview')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>Overview</div>
        <div class="nav-item" data-page="orchestration" onclick="navigateTo('orchestration')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><circle cx="5" cy="19" r="3"/><circle cx="19" cy="19" r="3"/><line x1="12" y1="8" x2="5" y2="16"/><line x1="12" y1="8" x2="19" y2="16"/></svg>Orchestration<span class="nav-badge" id="nav-agent-count">5</span></div>
        <div class="nav-item" data-page="pipeline" onclick="navigateTo('pipeline')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v4H3zM3 10h18v4H3zM3 17h18v4H3z"/></svg>Hiring Pipeline</div>
        <div class="nav-item" data-page="tasks" onclick="navigateTo('tasks')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Tasks<span class="nav-badge" id="nav-task-count">0</span></div>
      </div>
      <div class="nav-section">
        <div class="nav-section-label">Finance</div>
        <div class="nav-item" data-page="payments" onclick="navigateTo('payments')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>Payment Ledger</div>
      </div>
      <div class="nav-section">
        <div class="nav-section-label">Intelligence</div>
        <div class="nav-item" data-page="metrics" onclick="navigateTo('metrics')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>Metrics</div>
      </div>
      <div class="nav-section">
        <div class="nav-section-label">Governance</div>
        <div class="nav-item" data-page="approvals" onclick="navigateTo('approvals')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>Approvals<span class="nav-badge" id="nav-approval-count">0</span></div>
        <div class="nav-item" data-page="safety" onclick="navigateTo('safety')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Responsible AI</div>
      </div>
    </nav>
    <div class="sidebar-footer"><div class="system-status"><div class="status-dot" id="sidebar-status-dot"></div><span id="sidebar-status-text">connecting...</span></div></div>
  </aside>
  <div class="main-content">
    <div class="top-bar">
      <div class="top-bar-left">
        <span class="page-title" id="page-title">Overview</span>
        <span class="gpt4o-badge" id="gpt4o-badge">GPT-4o LIVE</span>
        <span class="demo-badge" id="demo-badge">DEMO MODE</span>
        <span class="azure-badge">Azure Container Apps</span>
      </div>
      <div class="top-bar-right">
        <button class="btn btn-sm btn-success" id="live-demo-btn" onclick="runLiveDemo()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>Live Demo</button>
        <button class="btn btn-sm" id="demo-btn" onclick="toggleDemo()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>Auto Demo</button>
        <button class="btn btn-sm btn-primary" onclick="openTaskModal()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>New Task</button>
      </div>
    </div>
    <div class="page-area">
      <!-- ═══════ OVERVIEW ═══════ -->
      <div class="page active" id="page-overview">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Agents</div><div class="stat-value accent" id="stat-agents">--</div><div class="stat-change up" id="stat-agents-sub">3 internal + 2 external</div></div>
          <div class="stat-card"><div class="stat-label">Tasks Completed</div><div class="stat-value green" id="stat-completed">--</div><div class="stat-change up" id="stat-completion-rate">--</div></div>
          <div class="stat-card"><div class="stat-label">Total Tasks</div><div class="stat-value" id="stat-jobs">--</div><div class="stat-change" id="stat-running-info">--</div></div>
          <div class="stat-card"><div class="stat-label">USDC Spent</div><div class="stat-value green" id="stat-spent">--</div><div class="stat-change up">via x402 protocol</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Live Activity Feed</span><span style="font-size:10px;color:var(--text-muted)" id="activity-source">Real-time</span></div><div class="card-body" id="activity-feed" style="max-height:380px;overflow-y:auto"><div class="empty-state">Loading...</div></div></div>
          <div>
            <div class="card" style="margin-bottom:12px"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--accent-light)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 12l2 2 4-4"/></svg>Agent Performance</span></div><div class="card-body"><div class="chart-container" style="height:160px"><canvas id="overview-perf-chart"></canvas></div></div></div>
            <div class="card"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--cyan)" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Submit Task</span></div><div class="card-body"><input class="form-input" id="inline-task-input" placeholder="Describe a task for the CEO agent..." style="margin-bottom:6px"/><div style="display:flex;gap:6px"><input class="form-input" id="inline-budget-input" type="number" value="1.0" min="0.01" max="100" step="0.01" style="width:90px" placeholder="USDC"/><button class="btn btn-primary" id="submit-btn" style="flex:1" onclick="submitInlineTask()">Submit to CEO</button></div></div></div>
          </div>
        </div>
      </div>

      <!-- ═══════ ORCHESTRATION ═══════ -->
      <div class="page" id="page-orchestration">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Registered Agents</div><div class="stat-value accent" id="orch-total">--</div></div>
          <div class="stat-card"><div class="stat-label">Active Now</div><div class="stat-value green" id="orch-active">0</div></div>
          <div class="stat-card"><div class="stat-label">Tasks in Queue</div><div class="stat-value" style="color:var(--yellow)" id="orch-queue">0</div></div>
          <div class="stat-card"><div class="stat-label">Avg Response</div><div class="stat-value" id="orch-avg-resp">--</div></div>
        </div>
        <div class="card" style="margin-bottom:12px">
          <div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--accent-light)" stroke-width="2"><circle cx="12" cy="5" r="3"/><circle cx="5" cy="19" r="3"/><circle cx="19" cy="19" r="3"/><line x1="12" y1="8" x2="5" y2="16"/><line x1="12" y1="8" x2="19" y2="16"/></svg>Agent Orchestration Flow</span><span style="font-size:10px;color:var(--text-muted)">CEO dispatches to specialized agents</span></div>
          <div class="card-body">
            <div class="orch-flow" id="orch-flow"></div>
          </div>
        </div>
        <div class="grid-2" style="grid-template-columns:1fr 340px">
          <div class="card"><div class="card-header"><span class="card-title">Agent Roster</span><div id="agent-filter-pills" style="display:flex;gap:4px"></div></div><div class="card-body-flush" id="orch-agent-list" style="max-height:350px;overflow-y:auto"><div class="empty-state">Loading agents...</div></div></div>
          <div id="orch-agent-detail" class="detail-panel"><div class="empty-state" style="padding:40px 16px">Select an agent to view details</div></div>
        </div>
      </div>

      <!-- ═══════ HIRING PIPELINE (KANBAN) ═══════ -->
      <div class="page" id="page-pipeline">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Job Postings</div><div class="stat-value accent" id="pipe-postings">--</div></div>
          <div class="stat-card"><div class="stat-label">Candidates</div><div class="stat-value" id="pipe-candidates">--</div></div>
          <div class="stat-card"><div class="stat-label">AI Evaluated</div><div class="stat-value green" id="pipe-evaluated">--</div></div>
          <div class="stat-card"><div class="stat-label">HITL Approved</div><div class="stat-value" style="color:var(--cyan)" id="pipe-approved">--</div></div>
        </div>
        <div class="card">
          <div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--accent-light)" stroke-width="2"><path d="M3 3h18v4H3zM3 10h18v4H3zM3 17h18v4H3z"/></svg>Hiring Pipeline</span><span style="font-size:10px;color:var(--text-muted)">Job Postings &rarr; Candidates &rarr; AI Evaluation &rarr; HITL Approval &rarr; Hired</span></div>
          <div class="card-body" style="overflow-x:auto">
            <div class="kanban" id="kanban-board"></div>
          </div>
        </div>
      </div>

      <!-- ═══════ TASKS ═══════ -->
      <div class="page" id="page-tasks">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Tasks</div><div class="stat-value accent" id="tasks-total">--</div></div>
          <div class="stat-card"><div class="stat-label">Completed</div><div class="stat-value green" id="tasks-completed">--</div></div>
          <div class="stat-card"><div class="stat-label">Running</div><div class="stat-value" style="color:var(--yellow)" id="tasks-running">--</div></div>
          <div class="stat-card"><div class="stat-label">GPT-4o Responses</div><div class="stat-value" style="color:var(--green)" id="tasks-gpt4o">--</div></div>
        </div>
        <div class="card"><div class="card-header"><span class="card-title">Task History</span><span style="font-size:10px;color:var(--text-muted)">Agent responses from GPT-4o</span></div><div class="card-body-flush" id="task-table" style="max-height:500px;overflow-y:auto"><div class="empty-state">Loading tasks...</div></div></div>
      </div>

      <!-- ═══════ PAYMENT LEDGER ═══════ -->
      <div class="page" id="page-payments">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Payments</div><div class="stat-value accent" id="pay-total">--</div></div>
          <div class="stat-card"><div class="stat-label">Total Spent</div><div class="stat-value green" id="pay-spent">--</div></div>
          <div class="stat-card"><div class="stat-label">External (x402)</div><div class="stat-value" style="color:var(--yellow)" id="pay-external">--</div></div>
          <div class="stat-card"><div class="stat-label">Agents Paid</div><div class="stat-value" style="color:var(--cyan)" id="pay-agents-paid">--</div></div>
        </div>
        <div class="grid-2" style="margin-bottom:14px">
          <div class="card"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--accent-light)" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>Budget Allocation by Agent</span></div><div class="card-body"><div class="chart-container" style="height:180px"><canvas id="pay-spend-chart"></canvas></div></div></div>
          <div class="card"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>x402 Payment Protocol</span></div><div class="card-body" style="font-size:12px">
            <div style="display:flex;flex-direction:column;gap:6px">
              <div style="display:flex;align-items:center;gap:8px"><span class="badge badge-green">1</span><span>Task Submission &mdash; CEO receives and analyzes</span></div>
              <div style="display:flex;align-items:center;gap:8px"><span class="badge badge-blue">2</span><span>Agent Discovery &mdash; Skill matching via registry</span></div>
              <div style="display:flex;align-items:center;gap:8px"><span class="badge badge-purple">3</span><span>Budget Allocation &mdash; USDC reserved in escrow</span></div>
              <div style="display:flex;align-items:center;gap:8px"><span class="badge badge-yellow">4</span><span>x402 Payment &mdash; EIP-712 signed proof to agent</span></div>
              <div style="display:flex;align-items:center;gap:8px"><span class="badge badge-cyan">5</span><span>Agent Execution &mdash; GPT-4o powers the response</span></div>
              <div style="display:flex;align-items:center;gap:8px"><span class="badge badge-muted">6</span><span>Settlement &mdash; Payment released on completion</span></div>
            </div>
          </div></div>
        </div>
        <div class="card"><div class="card-header"><span class="card-title">Payment Log</span><span style="font-size:10px;color:var(--text-muted)" id="pay-count-label">0 transactions</span></div><div class="card-body-flush" id="payment-table" style="max-height:350px;overflow-y:auto"><div class="empty-state">No transactions yet.</div></div></div>
      </div>

      <!-- ═══════ METRICS ═══════ -->
      <div class="page" id="page-metrics">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Spend</div><div class="stat-value" id="m-total-spend">--</div></div>
          <div class="stat-card"><div class="stat-label">Completion Rate</div><div class="stat-value green" id="m-success-rate">--</div></div>
          <div class="stat-card"><div class="stat-label">Avg Response</div><div class="stat-value accent" id="m-avg-response">--</div></div>
          <div class="stat-card"><div class="stat-label">GPT-4o Tasks</div><div class="stat-value" id="m-gpt4o">--</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><div class="card-header"><span class="card-title">Agent Performance</span></div><div class="card-body"><div class="chart-container"><canvas id="perf-chart"></canvas></div></div></div>
          <div class="card"><div class="card-header"><span class="card-title">Spending Distribution</span></div><div class="card-body"><div class="chart-container"><canvas id="spend-by-agent-chart"></canvas></div></div></div>
        </div>
      </div>

      <!-- ═══════ APPROVALS (HITL) ═══════ -->
      <div class="page" id="page-approvals">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Pending</div><div class="stat-value" style="color:var(--yellow)" id="hitl-pending">--</div></div>
          <div class="stat-card"><div class="stat-label">Approved</div><div class="stat-value green" id="hitl-approved">--</div></div>
          <div class="stat-card"><div class="stat-label">Rejected</div><div class="stat-value" style="color:var(--red)" id="hitl-rejected">--</div></div>
          <div class="stat-card"><div class="stat-label">Auto-Approved</div><div class="stat-value accent" id="hitl-auto">--</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--yellow)" stroke-width="2"><path d="M9 11l3 3L22 4"/></svg>Pending Approvals</span><span style="font-size:10px;color:var(--text-muted)">Human-in-the-Loop</span></div><div class="card-body" id="hitl-pending-list" style="max-height:350px;overflow-y:auto"><div class="empty-state">No pending approvals</div></div></div>
          <div class="card"><div class="card-header"><span class="card-title">Approval History</span></div><div class="card-body-flush" id="hitl-history" style="max-height:350px;overflow-y:auto"><div class="empty-state">No approval history</div></div></div>
        </div>
      </div>

      <!-- ═══════ RESPONSIBLE AI ═══════ -->
      <div class="page" id="page-safety">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Items Checked</div><div class="stat-value accent" id="rai-checked">--</div></div>
          <div class="stat-card"><div class="stat-label">Flagged</div><div class="stat-value" style="color:var(--yellow)" id="rai-flagged">--</div></div>
          <div class="stat-card"><div class="stat-label">Blocked</div><div class="stat-value" style="color:var(--red)" id="rai-blocked">--</div></div>
          <div class="stat-card"><div class="stat-label">Fairness Score</div><div class="stat-value green" id="rai-fairness">--</div></div>
        </div>
        <div class="grid-2" style="margin-bottom:14px">
          <div class="card"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Content Safety Gauges</span></div><div class="card-body">
            <div class="gauge-row">
              <div class="gauge"><div class="gauge-value" style="color:var(--green)" id="rai-safe-pct">--</div><div class="gauge-label">Safe Rate</div><div class="gauge-bar"><div class="gauge-bar-fill" id="rai-safe-bar" style="width:0;background:var(--green)"></div></div></div>
              <div class="gauge"><div class="gauge-value" style="color:var(--yellow)" id="rai-warn-pct">--</div><div class="gauge-label">Warning Rate</div><div class="gauge-bar"><div class="gauge-bar-fill" id="rai-warn-bar" style="width:0;background:var(--yellow)"></div></div></div>
              <div class="gauge"><div class="gauge-value" style="color:var(--red)" id="rai-block-pct">--</div><div class="gauge-label">Block Rate</div><div class="gauge-bar"><div class="gauge-bar-fill" id="rai-block-bar" style="width:0;background:var(--red)"></div></div></div>
            </div>
            <div class="detail-section" style="margin-top:10px">
              <div class="detail-section-title">Detailed Counts</div>
              <div class="detail-row"><span class="label">Resumes Checked</span><span class="value" id="rai-resumes">0</span></div>
              <div class="detail-row"><span class="label">Job Postings Checked</span><span class="value" id="rai-postings">0</span></div>
              <div class="detail-row"><span class="label">Safe</span><span class="value" style="color:var(--green)" id="rai-safe">0</span></div>
              <div class="detail-row"><span class="label">Warnings</span><span class="value" style="color:var(--yellow)" id="rai-warnings">0</span></div>
            </div>
          </div></div>
          <div class="card"><div class="card-header"><span class="card-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--purple)" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>Bias Report &amp; Audit Trail</span></div><div class="card-body">
            <div class="detail-section">
              <div class="detail-row"><span class="label">Total Decisions</span><span class="value" id="rai-decisions">0</span></div>
              <div class="detail-row"><span class="label">Flagged Decisions</span><span class="value" id="rai-flagged-decisions">0</span></div>
              <div id="rai-bias-indicators"></div>
              <div id="rai-recommendations" style="margin-top:10px"></div>
            </div>
          </div></div>
        </div>
      </div>
    </div>
    <div class="azure-footer">
      <span>Powered by</span>
      <span class="footer-badge azure">Azure OpenAI GPT-4o</span>
      <span class="footer-badge cosmos">Cosmos DB</span>
      <span class="footer-badge framework">MS Agent Framework</span>
      <span>&middot; HireWire v2.0 &middot; Microsoft AI Dev Days 2026</span>
    </div>
  </div>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="task-modal"><div class="modal"><div class="modal-header"><span class="modal-title">Submit New Task</span><button class="modal-close" onclick="closeTaskModal()">&times;</button></div><div class="modal-body"><div class="step-indicator"><div class="step-dot active" id="step-1">1</div><div class="step-line" id="step-line-1"></div><div class="step-dot" id="step-2">2</div><div class="step-line" id="step-line-2"></div><div class="step-dot" id="step-3">\u2713</div></div><div class="form-group"><label class="form-label">Task Description</label><input class="form-input" id="modal-task-input" placeholder="e.g. Analyze competitor pricing for AI agent platforms..." maxlength="2000"/><div class="form-hint" id="task-hint">Describe what you need done. The CEO agent will route it to the best agent.</div></div><div class="form-group"><label class="form-label">Budget (USDC)</label><input class="form-input" id="modal-budget-input" type="number" value="2.0" min="0.01" max="1000" step="0.01"/><div class="form-hint">Budget will be allocated via x402 protocol. GPT-4o powers the response.</div></div><div id="modal-status" style="display:none;padding:10px;border-radius:8px;font-size:12px;margin-top:8px"></div></div><div class="modal-footer"><button class="btn" onclick="closeTaskModal()">Cancel</button><button class="btn btn-primary" id="modal-submit-btn" onclick="submitModalTask()">Submit Task</button></div></div></div>

<!-- LIVE DEMO PIPELINE OVERLAY -->
<div class="pipeline-overlay" id="pipeline-overlay">
  <div class="pipeline-panel">
    <div class="pipeline-header">
      <h2><div class="live-dot"></div>Live Pipeline</h2>
      <button class="modal-close" onclick="closePipeline()">&times;</button>
    </div>
    <div class="pipeline-body">
      <div class="pipeline-task">
        <div class="pipeline-task-label">Task</div>
        <div class="pipeline-task-text" id="pipeline-task-text">Preparing...</div>
      </div>
      <div class="pipeline-stages" id="pipeline-stages">
        <div class="pipeline-stage waiting" id="ps-1"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">1</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Register Task</div><div class="pipeline-stage-detail" id="ps-1-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-1-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-2"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">2</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Discover Agents</div><div class="pipeline-stage-detail" id="ps-2-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-2-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-3"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">3</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Hire Agent</div><div class="pipeline-stage-detail" id="ps-3-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-3-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-4"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">4</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Pay via x402</div><div class="pipeline-stage-detail" id="ps-4-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-4-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-5"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">5</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Execute (GPT-4o)</div><div class="pipeline-stage-detail" id="ps-5-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-5-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-6"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">6</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Rate &amp; Verify</div><div class="pipeline-stage-detail" id="ps-6-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-6-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-7"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">7</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Dashboard Update</div><div class="pipeline-stage-detail" id="ps-7-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-7-time"></div></div>
      </div>
      <div class="pipeline-result" id="pipeline-result">
        <div class="pipeline-result-header">
          <div class="pipeline-result-title">Pipeline Complete</div>
          <div class="pipeline-result-stats">
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-agent">--</div><div class="pipeline-result-stat-label">Agent</div></div>
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-cost">--</div><div class="pipeline-result-stat-label">Cost</div></div>
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-time">--</div><div class="pipeline-result-stat-label">Time</div></div>
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-model">--</div><div class="pipeline-result-stat-label">Model</div></div>
          </div>
        </div>
        <div class="pipeline-result-preview" id="pr-preview"></div>
      </div>
    </div>
    <div class="pipeline-footer">
      <div class="pipeline-total" id="pipeline-total">Starting pipeline...</div>
      <button class="btn btn-sm btn-primary" id="pipeline-again-btn" style="display:none" onclick="runLiveDemo()">Run Again</button>
    </div>
  </div>
</div>
<div class="toast-container" id="toast-container"></div>
<script>
var API=window.location.origin,currentPage='overview',selectedAgent=null,demoRunning=false,chartInstances={},cachedAgents=[],cachedStats=null,offlineMode=false;

// ── STANDALONE DEMO DATA (renders without backend) ──
var DEMO_DATA={
  health:{agents_count:5,tasks_total:12,tasks_completed:9,tasks_running:1,tasks_pending:2,total_spent_usdc:7.2341,gpt4o_available:true,status:'healthy'},
  stats:{agents_count:5,total_spent_usdc:7.2341,completion_rate:75,avg_response_ms:1247,gpt4o_tasks:9,agent_spend:{builder:1.82,research:2.31,'designer-ext-001':1.65,'analyst-ext-001':1.44}},
  activity:[
    {type:'green',icon:'\u2713',text:'<strong>research-agent</strong> completed "Analyze competitor pricing across top 5 AI agent platforms" via <strong>GPT-4o</strong>',time:'2m ago'},
    {type:'blue',icon:'\u2192',text:'CEO dispatched task to <strong>builder-agent</strong>: "Build landing page component with responsive design"',time:'5m ago'},
    {type:'accent',icon:'$',text:'<strong>x402 payment</strong> of $1.25 USDC to designer-ext-001 settled on-chain',time:'8m ago'},
    {type:'green',icon:'\u2713',text:'<strong>builder-agent</strong> completed "Deploy FastAPI microservice to Azure Container Apps" via <strong>GPT-4o</strong>',time:'12m ago'},
    {type:'yellow',icon:'\u26A0',text:'HITL approval requested: hire <strong>analyst-ext-001</strong> for $2.00 USDC competitive analysis',time:'15m ago'},
    {type:'blue',icon:'\u2192',text:'CEO dispatched parallel tasks to <strong>research-agent</strong> and <strong>builder-agent</strong>',time:'18m ago'},
    {type:'accent',icon:'$',text:'<strong>x402 payment</strong> of $0.85 USDC to analyst-ext-001 settled on-chain',time:'22m ago'},
    {type:'green',icon:'\u2713',text:'<strong>research-agent</strong> completed "Survey agent memory architectures" via <strong>GPT-4o</strong>',time:'25m ago'}
  ],
  agents:[
    {name:'ceo-agent',description:'Coordinator: decomposes tasks, selects agents, manages budget',skills:['orchestration','task-decomposition','budget-management','agent-selection'],protocol:'agent-framework',payment:'internal',price_per_call:'$0.00',endpoint:'/agents/ceo',is_external:false},
    {name:'builder-agent',description:'Developer: writes code, deploys services, runs tests',skills:['python','fastapi','docker','azure-deployment','testing'],protocol:'agent-framework',payment:'internal',price_per_call:'$0.00',endpoint:'/agents/builder',is_external:false},
    {name:'research-agent',description:'Analyst: competitive research, market analysis, data gathering',skills:['web-search','analysis','report-generation','summarization'],protocol:'agent-framework',payment:'internal',price_per_call:'$0.00',endpoint:'/agents/research',is_external:false},
    {name:'designer-ext-001',description:'External UI/UX designer specializing in dashboards and data visualization',skills:['ui-design','figma','css','visualization','responsive'],protocol:'a2a',payment:'x402',price_per_call:'$1.25',endpoint:'https://agents.example.com/designer',is_external:true},
    {name:'analyst-ext-001',description:'External market analyst providing competitive intelligence and pricing analysis',skills:['market-analysis','pricing','competitive-intel','forecasting'],protocol:'a2a',payment:'x402',price_per_call:'$0.85',endpoint:'https://agents.example.com/analyst',is_external:true}
  ],
  tasks:[
    {task_id:'task-001',description:'Analyze competitor pricing across top 5 AI agent platforms',status:'completed',created_at:Date.now()/1000-120,result:{assigned_agent:'research-agent',model:'gpt-4o',estimated_cost:0.85,agent_response_preview:'Competitive analysis of 5 AI agent platforms: AutoGPT ($0/call, open-source), CrewAI ($0.02/call), LangChain Agents ($0.01-0.05/call), Microsoft Autogen ($0/call, Azure costs), SuperAGI ($0.03/call). Key finding: no platform offers real USDC agent-to-agent payments...'}},
    {task_id:'task-002',description:'Build landing page component with responsive design',status:'completed',created_at:Date.now()/1000-300,result:{assigned_agent:'builder-agent',model:'gpt-4o',estimated_cost:0.0,agent_response_preview:'Created responsive landing page using Tailwind CSS with dark mode support. Components: hero section, feature grid, pricing table, CTA. Deployed to Azure Container Apps at hirewire-api.purplecliff...'}},
    {task_id:'task-003',description:'Design dashboard wireframes for agent marketplace',status:'completed',created_at:Date.now()/1000-480,result:{assigned_agent:'designer-ext-001',model:'gpt-4o',estimated_cost:1.25,x402_payment:true,hitl_approval_id:'hitl-001',agent_response_preview:'Dashboard wireframes completed: 7 sections (Overview, Orchestration, Pipeline, Tasks, Payments, Metrics, Governance). Dark theme with indigo accent...'}},
    {task_id:'task-004',description:'Survey agent memory architectures and recommend approach',status:'completed',created_at:Date.now()/1000-600,result:{assigned_agent:'research-agent',model:'gpt-4o',estimated_cost:0.85,agent_response_preview:'Surveyed 4 memory architectures: A-Mem (reflective), MemGPT (tiered), CMA (colony), custom file-based. Recommendation: hybrid approach with file-based persistence for simplicity...'}},
    {task_id:'task-005',description:'Deploy FastAPI microservice to Azure Container Apps',status:'completed',created_at:Date.now()/1000-900,result:{assigned_agent:'builder-agent',model:'gpt-4o',estimated_cost:0.0,agent_response_preview:'Deployed HireWire API to Azure Container Apps. Endpoint: hirewire-api.purplecliff-500810ff.eastus.azurecontainerapps.io. Health check passing. 60+ REST endpoints active...'}},
    {task_id:'task-006',description:'Analyze market size for AI agent hiring platforms',status:'completed',created_at:Date.now()/1000-1200,result:{assigned_agent:'analyst-ext-001',model:'gpt-4o',estimated_cost:0.85,x402_payment:true,hitl_approval_id:'hitl-002',agent_response_preview:'AI agent market projected at $65B by 2028 (Gartner). Agent hiring/marketplace segment estimated at $2-4B. Key growth drivers: enterprise multi-agent adoption...'}},
    {task_id:'task-007',description:'Create unit tests for marketplace module',status:'completed',created_at:Date.now()/1000-1500,result:{assigned_agent:'builder-agent',model:'gpt-4o',estimated_cost:0.0,agent_response_preview:'Created 47 test cases for marketplace module covering: agent registration, skill matching, hiring workflow, budget management, payment verification. All tests passing...'}},
    {task_id:'task-008',description:'Evaluate Azure Cosmos DB vs PostgreSQL for agent persistence',status:'completed',created_at:Date.now()/1000-1800,result:{assigned_agent:'research-agent',model:'gpt-4o',estimated_cost:0.85,agent_response_preview:'Cosmos DB recommended for hackathon: serverless pricing ($0.25/million RU), global distribution, JSON-native, Azure-native integration. PostgreSQL better for production cost at scale...'}},
    {task_id:'task-009',description:'Design x402 payment protocol integration with escrow',status:'completed',created_at:Date.now()/1000-2100,result:{assigned_agent:'designer-ext-001',model:'gpt-4o',estimated_cost:1.25,x402_payment:true,hitl_approval_id:'hitl-003',agent_response_preview:'x402 escrow flow: 1) CEO reserves USDC in escrow smart contract 2) EIP-712 signed payment proof sent to external agent 3) Agent verifies proof, executes task 4) Settlement releases funds on completion...'}},
    {task_id:'task-010',description:'Build real-time metrics dashboard with Chart.js',status:'running',created_at:Date.now()/1000-60,result:{assigned_agent:'builder-agent',model:'gpt-4o',estimated_cost:0.0}},
    {task_id:'task-011',description:'Research Microsoft Agent Framework SDK best practices',status:'pending',created_at:Date.now()/1000-30,result:{}},
    {task_id:'task-012',description:'Generate competitive positioning document',status:'pending',created_at:Date.now()/1000-10,result:{}}
  ],
  transactions:[
    {from_agent:'ceo-agent',to_agent:'designer-ext-001',amount_usdc:1.25,task_id:'task-003',status:'completed',timestamp:Date.now()/1000-480},
    {from_agent:'ceo-agent',to_agent:'analyst-ext-001',amount_usdc:0.85,task_id:'task-006',status:'completed',timestamp:Date.now()/1000-1200},
    {from_agent:'ceo-agent',to_agent:'designer-ext-001',amount_usdc:1.25,task_id:'task-009',status:'completed',timestamp:Date.now()/1000-2100},
    {from_agent:'ceo-agent',to_agent:'research-agent',amount_usdc:0.85,task_id:'task-001',status:'completed',timestamp:Date.now()/1000-120},
    {from_agent:'ceo-agent',to_agent:'research-agent',amount_usdc:0.85,task_id:'task-004',status:'completed',timestamp:Date.now()/1000-600},
    {from_agent:'ceo-agent',to_agent:'builder-agent',amount_usdc:0.42,task_id:'task-002',status:'completed',timestamp:Date.now()/1000-300},
    {from_agent:'ceo-agent',to_agent:'analyst-ext-001',amount_usdc:0.85,task_id:'task-008',status:'completed',timestamp:Date.now()/1000-1800},
    {from_agent:'ceo-agent',to_agent:'builder-agent',amount_usdc:0.48,task_id:'task-007',status:'completed',timestamp:Date.now()/1000-1500},
    {from_agent:'ceo-agent',to_agent:'builder-agent',amount_usdc:0.44,task_id:'task-005',status:'completed',timestamp:Date.now()/1000-900}
  ],
  approvals:{stats:{pending:1,approved:4,rejected:1,auto_approved:3},pending:[{request_id:'hitl-pending-001',action:'Hire analyst-ext-001',description:'Competitive pricing analysis for enterprise segment — external agent, x402 payment required',cost_usdc:2.0,created_at:Date.now()/1000-60}],all:[
    {action:'Hire designer-ext-001',cost_usdc:1.25,status:'approved',reviewer:'dashboard_user',created_at:Date.now()/1000-480},
    {action:'Hire analyst-ext-001',cost_usdc:0.85,status:'approved',reviewer:'auto_policy',created_at:Date.now()/1000-1200},
    {action:'Hire designer-ext-001',cost_usdc:1.25,status:'auto_approved',reviewer:'auto_policy',created_at:Date.now()/1000-2100},
    {action:'Deploy to production',cost_usdc:0.0,status:'auto_approved',reviewer:'auto_policy',created_at:Date.now()/1000-900},
    {action:'Hire unknown-agent-007',cost_usdc:5.0,status:'rejected',reviewer:'dashboard_user',created_at:Date.now()/1000-3000},
    {action:'Budget increase to $50',cost_usdc:50.0,status:'auto_approved',reviewer:'auto_policy',created_at:Date.now()/1000-3600},
    {action:'Hire analyst-ext-001',cost_usdc:2.0,status:'pending',reviewer:'--',created_at:Date.now()/1000-60}
  ]},
  safety:{status:{total_checked:24,flagged:2,blocked:0,safe:21,warnings:3,resumes_checked:8,job_postings_checked:16},bias:{fairness_score:0.94,total_decisions:18,flagged_decisions:1,bias_indicators:{gender:0,age:0,ethnicity:0,disability:1},recommendations:['Continue monitoring disability-related language in job postings','Consider adding skill-blind evaluation for initial agent screening','All content safety checks passing — no blocked content detected']}}
};

function fmt(ts){if(!ts)return'--';var d=new Date(ts*1000);return d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
function fmtDate(ts){if(!ts)return'--';var d=new Date(ts*1000);return d.toLocaleDateString([],{month:'short',day:'numeric'})+' '+d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
function toast(msg,type){type=type||'info';var c=document.getElementById('toast-container'),el=document.createElement('div');el.className='toast '+type;el.textContent=msg;c.appendChild(el);setTimeout(function(){el.style.animation='fadeOut 0.3s ease';setTimeout(function(){el.remove()},300)},3000);}
async function fetchJSON(path){
  try{var r=await fetch(API+path,{signal:AbortSignal.timeout(3000)});if(!r.ok)throw new Error('not ok');offlineMode=false;return await r.json()}
  catch(e){
    offlineMode=true;
    // Fallback to demo data for standalone mode
    var map={'/health':DEMO_DATA.health,'/stats':DEMO_DATA.stats,'/activity':DEMO_DATA.activity,'/agents':DEMO_DATA.agents,'/tasks':DEMO_DATA.tasks,'/transactions':DEMO_DATA.transactions,'/approvals/stats':DEMO_DATA.approvals.stats,'/approvals/pending':DEMO_DATA.approvals.pending,'/approvals/all':DEMO_DATA.approvals.all,'/responsible-ai/status':DEMO_DATA.safety.status,'/responsible-ai/bias-report':DEMO_DATA.safety.bias};
    return map[path]||null;
  }
}

function navigateTo(page){
  currentPage=page;
  document.querySelectorAll('.nav-item').forEach(function(el){el.classList.toggle('active',el.dataset.page===page)});
  document.querySelectorAll('.page').forEach(function(el){el.classList.toggle('active',el.id==='page-'+page)});
  var titles={overview:'Overview',orchestration:'Agent Orchestration',pipeline:'Hiring Pipeline',tasks:'Tasks',payments:'Payment Ledger',metrics:'Metrics',approvals:'Approvals (HITL)',safety:'Responsible AI'};
  document.getElementById('page-title').textContent=titles[page]||page;
  if(page==='orchestration')renderOrchestrationPage();
  if(page==='pipeline')renderPipelinePage();
  if(page==='tasks')renderTasksPage();
  if(page==='payments')renderPaymentsPage();
  if(page==='metrics')renderMetricsPage();
  if(page==='approvals')renderApprovalsPage();
  if(page==='safety')renderSafetyPage();
}
function openTaskModal(){document.getElementById('task-modal').classList.add('active');document.getElementById('modal-task-input').focus();}
function closeTaskModal(){document.getElementById('task-modal').classList.remove('active');}

async function submitModalTask(){
  var input=document.getElementById('modal-task-input'),budget=document.getElementById('modal-budget-input'),btn=document.getElementById('modal-submit-btn'),desc=input.value.trim();
  var status=document.getElementById('modal-status'),hint=document.getElementById('task-hint');
  if(!desc){input.classList.add('form-error');hint.textContent='Please enter a task description';hint.className='form-hint error';setTimeout(function(){input.classList.remove('form-error');hint.textContent='Describe what you need done. The CEO agent will route it to the best agent.';hint.className='form-hint'},2000);return}
  btn.disabled=true;btn.textContent='Submitting...';
  document.getElementById('step-1').className='step-dot done';document.getElementById('step-line-1').className='step-line done';document.getElementById('step-2').className='step-dot active';
  try{var r=await fetch(API+'/tasks',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({description:desc,budget:parseFloat(budget.value)||1.0})});
  if(r.ok){document.getElementById('step-2').className='step-dot done';document.getElementById('step-line-2').className='step-line done';document.getElementById('step-3').className='step-dot done';status.style.display='block';status.style.background='var(--green-dim)';status.style.color='var(--green)';status.textContent='\u2713 Task submitted to CEO agent successfully!';input.classList.add('form-success');toast('Task submitted to CEO agent','success');setTimeout(function(){input.value='';closeTaskModal();resetModalSteps();refreshOverview()},1500)}else{status.style.display='block';status.style.background='var(--red-dim)';status.style.color='var(--red)';status.textContent='Submission failed. Please try again.';toast('Failed','error')}}
  catch(e){status.style.display='block';status.style.background='var(--red-dim)';status.style.color='var(--red)';status.textContent='Network error. Using demo mode.';toast('Network error — demo mode active','info')}finally{btn.disabled=false;btn.textContent='Submit Task'}}
function resetModalSteps(){['step-1','step-2','step-3'].forEach(function(id,i){document.getElementById(id).className='step-dot'+(i===0?' active':'')});['step-line-1','step-line-2'].forEach(function(id){document.getElementById(id).className='step-line'});var s=document.getElementById('modal-status');s.style.display='none';document.getElementById('modal-task-input').classList.remove('form-success','form-error')}

async function submitInlineTask(){
  var input=document.getElementById('inline-task-input'),budgetInput=document.getElementById('inline-budget-input'),desc=input.value.trim();if(!desc)return;
  var budget=parseFloat(budgetInput.value)||1.0;
  try{var r=await fetch(API+'/tasks',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({description:desc,budget:budget})});
  if(r.ok){toast('Task submitted to CEO agent','success');input.value='';setTimeout(refreshOverview,2000)}else toast('Failed','error')}
  catch(e){toast('Network error','error')}}

document.getElementById('modal-task-input').addEventListener('keydown',function(e){if(e.key==='Enter')submitModalTask()});
document.getElementById('inline-task-input').addEventListener('keydown',function(e){if(e.key==='Enter')submitInlineTask()});

// ── OVERVIEW ──
async function refreshOverview(){
  var res=await Promise.all([fetchJSON('/health'),fetchJSON('/stats'),fetchJSON('/activity')]);
  var h=res[0],stats=res[1],activity=res[2];
  cachedStats=stats;

  if(h){
    document.getElementById('stat-agents').textContent=h.agents_count;
    document.getElementById('stat-completed').textContent=h.tasks_completed;
    document.getElementById('stat-jobs').textContent=h.tasks_total;
    document.getElementById('stat-spent').textContent='$'+(h.total_spent_usdc||0).toFixed(2);
    document.getElementById('nav-agent-count').textContent=h.agents_count;
    document.getElementById('nav-task-count').textContent=h.tasks_total;
    document.getElementById('sidebar-status-dot').classList.remove('offline');
    if(offlineMode){
      document.getElementById('sidebar-status-text').textContent='Demo Mode (standalone)';
      document.getElementById('demo-badge').classList.add('active');
    } else {
      document.getElementById('sidebar-status-text').textContent=h.gpt4o_available?'GPT-4o Connected':'All systems healthy';
    }
    if(h.gpt4o_available)document.getElementById('gpt4o-badge').classList.add('active');
    var rate=h.tasks_total>0?Math.round(h.tasks_completed/h.tasks_total*100):0;
    document.getElementById('stat-completion-rate').textContent=rate+'% completion rate';
    document.getElementById('stat-running-info').textContent=h.tasks_running+' running, '+h.tasks_pending+' pending';
    document.getElementById('stat-running-info').className='stat-change'+(h.tasks_running>0?' up':'');
  } else {
    document.getElementById('sidebar-status-dot').classList.add('offline');
    document.getElementById('sidebar-status-text').textContent='Offline mode';
  }

  if(stats){
    var internal=stats.agents_count>3?3:stats.agents_count;
    var external=stats.agents_count-internal;
    document.getElementById('stat-agents-sub').textContent=internal+' internal + '+external+' external';
  }

  if(activity&&activity.length>0){
    document.getElementById('activity-source').textContent='Live ('+activity.length+' events)';
    var eventIcons={'green':'\u2713','blue':'\u2192','accent':'\u{1F4B0}','yellow':'\u26A0'};
    document.getElementById('activity-feed').innerHTML=activity.map(function(a){
      var icon=a.icon||eventIcons[a.type]||'\u2022';
      return'<div class="activity-item"><div class="activity-icon '+a.type+'">'+icon+'</div><div class="activity-text">'+a.text+'</div><div class="activity-time">'+a.time+'</div></div>';
    }).join('');
  }

  var hitlStats=await fetchJSON('/approvals/stats');
  if(hitlStats){document.getElementById('nav-approval-count').textContent=hitlStats.pending}
  if(stats&&stats.agent_spend){renderOverviewChart(stats.agent_spend)}
}

function renderOverviewChart(agentSpend){
  var ctx=document.getElementById('overview-perf-chart');if(!ctx)return;
  if(chartInstances.ovPerf)chartInstances.ovPerf.destroy();
  var labels=Object.keys(agentSpend).map(function(k){return k.replace(/-ext-\d+/,'')});
  var values=Object.values(agentSpend);
  chartInstances.ovPerf=new Chart(ctx,{type:'doughnut',data:{labels:labels,datasets:[{data:values,backgroundColor:['#6366f1','#22c55e','#3b82f6','#eab308','#ef4444','#a855f7'],borderColor:'#1c1c22',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#a1a1aa',font:{size:10},padding:6}}}}});
}

// ── ORCHESTRATION PAGE ──
var orchSelectedAgent=null;

async function renderOrchestrationPage(){
  var res=await Promise.all([fetchJSON('/agents'),fetchJSON('/health'),fetchJSON('/stats')]);
  var agents=res[0]||[],h=res[1],stats=res[2];
  cachedAgents=agents;

  document.getElementById('orch-total').textContent=agents.length;
  document.getElementById('orch-active').textContent=h?h.tasks_running:'0';
  document.getElementById('orch-queue').textContent=h?(h.tasks_pending+h.tasks_running):'0';
  document.getElementById('orch-avg-resp').textContent=stats?Math.round(stats.avg_response_ms||0)+'ms':'--';

  // Build orchestration flow visualization
  var agentConfig = [
    {name:'CEO',icon:'\u{1F451}',role:'Coordinator',bg:'var(--accent-glow)',color:'var(--accent-light)'},
    {name:'Builder',icon:'\u{1F528}',role:'Developer',bg:'var(--blue-dim)',color:'var(--blue)'},
    {name:'Research',icon:'\u{1F50D}',role:'Analyst',bg:'var(--green-dim)',color:'var(--green)'},
    {name:'Social',icon:'\u{1F4E3}',role:'Marketing',bg:'var(--yellow-dim)',color:'var(--yellow)'},
  ];

  var running=h?h.tasks_running:0;
  var flowHtml='';
  agentConfig.forEach(function(a,i){
    var isActive=i===0?(running>0):false;
    flowHtml+='<div class="orch-node"><div class="orch-node-box '+(isActive?'active':'idle')+'" style="background:'+(isActive?a.bg:'var(--bg)')+'">';
    flowHtml+='<div class="icon">'+a.icon+'</div>';
    flowHtml+='<div class="name">'+a.name+'</div>';
    flowHtml+='</div><div class="orch-node-status badge '+(isActive?'badge-green':'badge-muted')+'">'+(isActive?'active':'idle')+'</div></div>';
    if(i<agentConfig.length-1){
      flowHtml+='<div class="orch-arrow'+(i===0&&running>0?' active':'')+'">'+
        (i===0?'\u2192 \u2192':'\u2190 \u2192')+'</div>';
    }
  });
  // Add external agents
  var externals=agents.filter(function(a){return a.is_external});
  if(externals.length>0){
    flowHtml+='<div class="orch-arrow">\u2190 \u2192</div>';
    flowHtml+='<div class="orch-node"><div class="orch-node-box idle" style="background:var(--purple-dim)">';
    flowHtml+='<div class="icon">\u{1F310}</div>';
    flowHtml+='<div class="name">External x'+externals.length+'</div>';
    flowHtml+='</div><div class="orch-node-status badge badge-yellow">x402</div></div>';
  }
  document.getElementById('orch-flow').innerHTML=flowHtml;

  // Agent filter pills
  var filterEl=document.getElementById('agent-filter-pills');
  var filters=[{key:'all',label:'All'},{key:'internal',label:'Internal'},{key:'external',label:'External'}];
  filterEl.innerHTML=filters.map(function(f){
    var cls='filter-pill'+(orchFilter===f.key?' active':'');
    return'<button class="'+cls+'" onclick="orchSetFilter(\''+f.key+'\')">'+f.label+'</button>';
  }).join('');

  // Agent list
  var colors={builder:'var(--blue-dim)',research:'var(--green-dim)',designer:'var(--purple-dim)',analyst:'var(--yellow-dim)',ceo:'var(--accent-glow)'};
  var textColors={builder:'var(--blue)',research:'var(--green)',designer:'var(--purple)',analyst:'var(--yellow)',ceo:'var(--accent-light)'};
  var filteredAgents=agents.filter(function(a){
    if(orchFilter==='internal')return !a.is_external;
    if(orchFilter==='external')return a.is_external;
    return true;
  });
  var el=document.getElementById('orch-agent-list');
  el.innerHTML=filteredAgents.map(function(a){
    var origIdx=agents.indexOf(a);
    var key=a.name.split('-')[0];
    var bg=colors[key]||'var(--accent-glow)';var tc=textColors[key]||'var(--accent-light)';
    var avatarEmojis={ceo:'\u{1F451}',builder:'\u{1F528}',research:'\u{1F50D}',designer:'\u{1F3A8}',analyst:'\u{1F4CA}'};
    var emoji=avatarEmojis[key]||a.name[0].toUpperCase();
    return'<div class="agent-row'+(orchSelectedAgent===origIdx?' selected':'')+'" onclick="orchSelectAgent('+origIdx+')"><div class="agent-avatar" style="background:'+bg+';color:'+tc+'">'+emoji+'</div><div class="agent-info"><div class="agent-name">'+a.name+(a.is_external?' <span class="badge badge-yellow" style="font-size:8px;padding:1px 5px">x402</span>':'')+'</div><div class="agent-desc">'+a.description+'</div></div><div class="agent-stats"><div class="agent-stat-item"><div class="agent-stat-value" style="color:var(--green)">'+a.price_per_call+'</div><div class="agent-stat-label">Price</div></div></div></div>';
  }).join('');
  if(orchSelectedAgent!==null&&cachedAgents[orchSelectedAgent])orchRenderDetail(orchSelectedAgent);
}

var orchFilter='all';
function orchSetFilter(f){orchFilter=f;renderOrchestrationPage();}
function orchSelectAgent(i){orchSelectedAgent=i;renderOrchestrationPage();}
function orchRenderDetail(i){
  var a=cachedAgents[i];if(!a)return;
  var key=a.name.split('-')[0];
  var colors={builder:'var(--blue-dim)',research:'var(--green-dim)',designer:'var(--purple-dim)',analyst:'var(--yellow-dim)'};
  var tc={builder:'var(--blue)',research:'var(--green)',designer:'var(--purple)',analyst:'var(--yellow)'};
  var skillColors={'python':'tag-blue','fastapi':'tag-blue','docker':'tag-cyan','azure-deployment':'tag-cyan','testing':'tag-green','orchestration':'tag-accent','task-decomposition':'tag-accent','budget-management':'tag-yellow','agent-selection':'tag-purple','web-search':'tag-green','analysis':'tag-blue','report-generation':'tag-cyan','summarization':'tag-purple','ui-design':'tag-purple','figma':'tag-purple','css':'tag-blue','visualization':'tag-cyan','responsive':'tag-green','market-analysis':'tag-yellow','pricing':'tag-yellow','competitive-intel':'tag-blue','forecasting':'tag-cyan'};
  document.getElementById('orch-agent-detail').innerHTML='<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px"><div class="agent-avatar" style="background:'+(colors[key]||'var(--accent-glow)')+';color:'+(tc[key]||'var(--accent-light)')+';width:48px;height:48px;font-size:20px;border-radius:12px">'+a.name[0].toUpperCase()+'</div><div><div style="font-size:16px;font-weight:700">'+a.name+'</div><div style="font-size:11px;color:var(--text-muted);margin-top:2px">'+a.description+'</div></div></div><div class="detail-section"><div class="detail-section-title">Skills</div><div>'+a.skills.map(function(s){var sc=skillColors[s]||'tag-accent';return'<span class="tag '+sc+'">'+s+'</span>'}).join('')+'</div></div><div class="detail-section"><div class="detail-section-title">Configuration</div><div class="detail-row"><span class="label">Protocol</span><span class="value"><span class="badge badge-blue">'+a.protocol.toUpperCase()+'</span></span></div><div class="detail-row"><span class="label">Payment</span><span class="value">'+a.payment+'</span></div><div class="detail-row"><span class="label">Price</span><span class="value" style="color:var(--green);font-weight:700">'+a.price_per_call+'</span></div><div class="detail-row"><span class="label">Endpoint</span><span class="value" style="font-size:10px;word-break:break-all;font-family:monospace">'+a.endpoint+'</span></div><div class="detail-row"><span class="label">Type</span><span class="value">'+(a.is_external?'<span class="badge badge-yellow">External (x402)</span>':'<span class="badge badge-green">Internal</span>')+'</span></div></div>';
}

// ── HIRING PIPELINE (KANBAN) ──
async function renderPipelinePage(){
  var res=await Promise.all([fetchJSON('/tasks'),fetchJSON('/approvals/all'),fetchJSON('/agents')]);
  var tasks=res[0]||[],approvals=res[1]||[],agents=res[2]||[];

  // Build pipeline stages from real data
  var stages = {
    posting: [],    // tasks that are pending
    candidate: [],  // running tasks (agent discovery)
    evaluation: [], // completed with safety score
    hitl: [],       // has approval record
    hired: []       // completed with payment
  };

  tasks.forEach(function(t){
    var r=t.result||{};
    var card={id:t.task_id,title:t.description.substring(0,60),agent:r.assigned_agent||'--',cost:'$'+(r.estimated_cost||0).toFixed(2),model:r.model||'mock',status:t.status};
    if(t.status==='pending') stages.posting.push(card);
    else if(t.status==='running') stages.candidate.push(card);
    else if(t.status==='completed'&&!r.hitl_approval_id) stages.evaluation.push(card);
    else if(t.status==='completed'&&r.hitl_approval_id&&!r.x402_payment) stages.hitl.push(card);
    else if(t.status==='completed') stages.hired.push(card);
  });

  document.getElementById('pipe-postings').textContent=stages.posting.length;
  document.getElementById('pipe-candidates').textContent=stages.candidate.length;
  document.getElementById('pipe-evaluated').textContent=stages.evaluation.length+stages.hitl.length+stages.hired.length;
  document.getElementById('pipe-approved').textContent=stages.hitl.length+stages.hired.length;

  var colConfig=[
    {key:'posting',title:'Job Postings',color:'var(--blue)'},
    {key:'candidate',title:'Candidates',color:'var(--yellow)'},
    {key:'evaluation',title:'AI Evaluation',color:'var(--accent-light)'},
    {key:'hitl',title:'HITL Approval',color:'var(--cyan)'},
    {key:'hired',title:'Hired',color:'var(--green)'}
  ];

  var html='';
  colConfig.forEach(function(col){
    var cards=stages[col.key];
    html+='<div class="kanban-col"><div class="kanban-header"><span class="kanban-header-title" style="color:'+col.color+'">'+col.title+'</span><span class="kanban-header-count">'+cards.length+'</span></div><div class="kanban-body">';
    if(cards.length===0){
      html+='<div style="text-align:center;padding:20px 8px;font-size:10px;color:var(--text-muted)">No items</div>';
    } else {
      cards.slice(0,8).forEach(function(c){
        html+='<div class="kanban-card"><div class="kanban-card-title">'+c.title+'</div><div class="kanban-card-meta"><span>'+c.agent+'</span><span>'+c.cost+'</span>'+(c.model==='gpt-4o'?'<span class="gpt4o-tag">GPT-4o</span>':'')+'</div></div>';
      });
      if(cards.length>8) html+='<div style="text-align:center;font-size:10px;color:var(--text-muted);padding:4px">+'+(cards.length-8)+' more</div>';
    }
    html+='</div></div>';
  });
  document.getElementById('kanban-board').innerHTML=html;
}

// ── TASKS ──
async function renderTasksPage(){
  var tasks=await fetchJSON('/tasks');if(!tasks)return;
  var completed=tasks.filter(function(t){return t.status==='completed'}).length;
  var running=tasks.filter(function(t){return t.status==='running'}).length;
  var gpt4o=tasks.filter(function(t){return t.result&&t.result.model==='gpt-4o'}).length;
  document.getElementById('tasks-total').textContent=tasks.length;
  document.getElementById('tasks-completed').textContent=completed;
  document.getElementById('tasks-running').textContent=running;
  document.getElementById('tasks-gpt4o').textContent=gpt4o;

  var html='<table class="data-table"><thead><tr><th>Time</th><th>Task</th><th>Agent</th><th>Model</th><th>Response</th><th>Status</th></tr></thead><tbody>';
  tasks.forEach(function(t){
    var r=t.result||{};
    var sb=t.status==='completed'?'badge-green':t.status==='running'?'badge-yellow':t.status==='failed'?'badge-red':'badge-muted';
    var agent=r.assigned_agent||r.task_type||'ceo';
    var model=r.model||'--';
    var modelBadge=model==='gpt-4o'?'<span class="gpt4o-tag">GPT-4o</span>':'<span class="badge badge-muted">'+model+'</span>';
    var preview=r.agent_response_preview||'';
    var responseHtml=preview?'<div class="response-preview">'+preview+'</div>':'<span style="color:var(--text-muted)">--</span>';
    html+='<tr><td>'+fmtDate(t.created_at)+'</td><td style="color:var(--text);font-weight:500;max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+t.description+'</td><td>'+agent+'</td><td>'+modelBadge+'</td><td style="max-width:260px">'+responseHtml+'</td><td><span class="badge '+sb+'">'+t.status+'</span></td></tr>';
  });
  html+='</tbody></table>';
  document.getElementById('task-table').innerHTML=html;
}

// ── PAYMENTS ──
async function renderPaymentsPage(){
  var txs=await fetchJSON('/transactions');if(!txs)txs=[];
  var totalSpent=txs.reduce(function(s,t){return s+t.amount_usdc},0);
  var extTxs=txs.filter(function(t){return t.to_agent.indexOf('ext')>-1||t.to_agent.indexOf('designer')>-1||t.to_agent.indexOf('analyst')>-1});
  var extSpent=extTxs.reduce(function(s,t){return s+t.amount_usdc},0);
  var agentsPaid=new Set(txs.map(function(t){return t.to_agent})).size;
  document.getElementById('pay-total').textContent=txs.length;
  document.getElementById('pay-spent').textContent='$'+totalSpent.toFixed(4);
  document.getElementById('pay-external').textContent='$'+extSpent.toFixed(4);
  document.getElementById('pay-agents-paid').textContent=agentsPaid;
  document.getElementById('pay-count-label').textContent=txs.length+' transactions';

  var agentSpend={};
  txs.forEach(function(t){agentSpend[t.to_agent]=(agentSpend[t.to_agent]||0)+t.amount_usdc});
  var ctx=document.getElementById('pay-spend-chart');
  if(ctx){
    if(chartInstances.paySpend)chartInstances.paySpend.destroy();
    chartInstances.paySpend=new Chart(ctx,{type:'doughnut',data:{labels:Object.keys(agentSpend),datasets:[{data:Object.values(agentSpend),backgroundColor:['#6366f1','#22c55e','#3b82f6','#eab308','#ef4444','#a855f7'],borderColor:'#1c1c22',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#a1a1aa',font:{size:10},padding:6}}}}});
  }

  document.getElementById('payment-table').innerHTML='<table class="data-table"><thead><tr><th>Time</th><th>From</th><th>To</th><th>Amount</th><th>Task</th><th>Status</th></tr></thead><tbody>'+txs.map(function(t){
    var sb=t.status==='completed'?'badge-green':t.status==='pending'?'badge-yellow':'badge-muted';
    var isExt=t.to_agent.indexOf('ext')>-1||t.to_agent.indexOf('designer')>-1||t.to_agent.indexOf('analyst')>-1;
    return'<tr><td>'+fmtDate(t.timestamp)+'</td><td>'+t.from_agent+'</td><td style="color:var(--text);font-weight:500">'+t.to_agent+(isExt?' <span class="gpt4o-tag">x402</span>':'')+'</td><td style="color:var(--green);font-weight:600">$'+t.amount_usdc.toFixed(4)+'</td><td style="font-size:10px;color:var(--text-muted)">'+t.task_id+'</td><td><span class="badge '+sb+'">'+t.status+'</span></td></tr>';
  }).join('')+'</tbody></table>';
}

// ── METRICS ──
async function renderMetricsPage(){
  var stats=cachedStats||await fetchJSON('/stats');
  if(!stats)stats={};
  document.getElementById('m-total-spend').textContent='$'+(stats.total_spent_usdc||0).toFixed(2);
  document.getElementById('m-success-rate').textContent=(stats.completion_rate||0).toFixed(0)+'%';
  document.getElementById('m-avg-response').textContent=(stats.avg_response_ms||0).toFixed(0)+'ms';
  document.getElementById('m-gpt4o').textContent=stats.gpt4o_tasks||0;
  renderPerfChart();
  renderSpendChart(stats.agent_spend||{});
}
function renderPerfChart(){
  var ctx=document.getElementById('perf-chart');if(!ctx)return;if(chartInstances.perf)chartInstances.perf.destroy();
  chartInstances.perf=new Chart(ctx,{type:'radar',data:{labels:['Speed','Quality','Cost Efficiency','Reliability','Versatility'],datasets:[{label:'Builder',data:[85,92,78,96,70],borderColor:'#6366f1',backgroundColor:'rgba(99,102,241,0.15)',pointBackgroundColor:'#6366f1'},{label:'Research',data:[70,88,85,92,90],borderColor:'#22c55e',backgroundColor:'rgba(34,197,94,0.15)',pointBackgroundColor:'#22c55e'},{label:'External',data:[75,90,65,88,95],borderColor:'#eab308',backgroundColor:'rgba(234,179,8,0.15)',pointBackgroundColor:'#eab308'}]},options:{responsive:true,maintainAspectRatio:false,scales:{r:{grid:{color:'#27272a'},pointLabels:{color:'#a1a1aa',font:{size:10}},ticks:{display:false},suggestedMin:0,suggestedMax:100}},plugins:{legend:{labels:{color:'#a1a1aa',font:{size:10}}}}}});
}
function renderSpendChart(agentSpend){
  var ctx=document.getElementById('spend-by-agent-chart');if(!ctx)return;if(chartInstances.spend)chartInstances.spend.destroy();
  var labels=Object.keys(agentSpend);var values=Object.values(agentSpend);
  if(labels.length===0){labels=['builder','research','external'];values=[0.06,0.03,0.04]}
  chartInstances.spend=new Chart(ctx,{type:'doughnut',data:{labels:labels,datasets:[{data:values,backgroundColor:['#6366f1','#22c55e','#3b82f6','#eab308','#ef4444','#a855f7'],borderColor:'#1c1c22',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#a1a1aa',font:{size:10},padding:8}}}}});
}

// ── DEMO ──
async function toggleDemo(){
  var btn=document.getElementById('demo-btn'),badge=document.getElementById('demo-badge');btn.disabled=true;
  try{if(demoRunning){await fetch(API+'/demo/stop').catch(function(){});demoRunning=false;btn.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>Auto Demo';badge.classList.remove('active');toast('Demo stopped','info')}
  else{await fetch(API+'/demo/seed').catch(function(){});await fetch(API+'/demo/start').catch(function(){});demoRunning=true;btn.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>Stop Demo';badge.classList.add('active');toast('Demo activated','success');refreshOverview()}}
  catch(e){toast('Demo error','error')}finally{btn.disabled=false}}

async function checkDemoStatus(){try{var d=await fetchJSON('/demo/status');if(d&&d.running){demoRunning=true;document.getElementById('demo-btn').innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>Stop Demo';document.getElementById('demo-badge').classList.add('active')}}catch(e){}}

// ── LIVE DEMO PIPELINE ──
var liveDemoRunning=false,liveDemoIndex=0;

function closePipeline(){document.getElementById('pipeline-overlay').classList.remove('active');}

function resetPipelineUI(){
  for(var i=1;i<=7;i++){
    var el=document.getElementById('ps-'+i);
    el.className='pipeline-stage waiting';
    document.getElementById('ps-'+i+'-detail').textContent='Waiting...';
    document.getElementById('ps-'+i+'-time').textContent='';
  }
  document.getElementById('pipeline-result').classList.remove('visible');
  document.getElementById('pipeline-again-btn').style.display='none';
  document.getElementById('pipeline-total').textContent='Starting pipeline...';
}

async function runLiveDemo(){
  if(liveDemoRunning)return;
  liveDemoRunning=true;
  var btn=document.getElementById('live-demo-btn');
  btn.disabled=true;
  btn.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation:spin 1s linear infinite"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>Running...';

  resetPipelineUI();
  document.getElementById('pipeline-overlay').classList.add('active');
  document.getElementById('pipeline-task-text').textContent='Submitting to CEO agent...';

  function activateStage(n){
    if(n>6)return;
    document.getElementById('ps-'+n).className='pipeline-stage active';
  }
  activateStage(1);

  try{
    var data;
    if(!offlineMode){
      var r=await fetch(API+'/demo/live',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({task_index:liveDemoIndex}),signal:AbortSignal.timeout(5000)});
      if(!r.ok)throw new Error('API error '+r.status);
      data=await r.json();
    } else {
      // Standalone demo simulation
      var demoTasks=[
        {desc:'Analyze competitor pricing across top 5 AI agent platforms',agent:'research-agent',cost:0.8500,model:'gpt-4o',preview:'Competitive analysis of 5 AI agent platforms: AutoGPT ($0/call), CrewAI ($0.02/call), LangChain Agents ($0.01-0.05/call), Microsoft Autogen ($0/call), SuperAGI ($0.03/call). Key finding: no platform offers real USDC agent-to-agent payments. HireWire is uniquely positioned as the first marketplace with x402 protocol integration.'},
        {desc:'Build responsive landing page for HireWire product launch',agent:'builder-agent',cost:0.0000,model:'gpt-4o',preview:'Created landing page with hero section, feature grid (4 differentiators), pricing table, and CTA. Tech: Tailwind CSS, responsive breakpoints, dark mode support. Deployed to Azure Container Apps. Load time: 1.2s. Lighthouse score: 94.'},
        {desc:'Design escrow payment flow for x402 agent settlements',agent:'designer-ext-001',cost:1.2500,model:'gpt-4o',preview:'Designed 6-step escrow flow: (1) CEO reserves USDC, (2) EIP-712 signature generated, (3) Proof sent to external agent, (4) Agent verifies and executes, (5) Result validated, (6) Settlement released. Includes rollback on failure and dispute resolution.'}
      ];
      var dt=demoTasks[liveDemoIndex%3];
      data={description:dt.desc,agent:dt.agent,cost_usdc:dt.cost,model:dt.model,response_preview:dt.preview,task_id:'demo-'+Date.now(),total_ms:Math.round(800+Math.random()*1200),stages:[
        {stage:1,detail:'Task registered in marketplace (ID: demo-'+Date.now().toString(36)+')',duration_ms:Math.round(40+Math.random()*80)},
        {stage:2,detail:'Skill matching: '+dt.agent+' selected (score: 0.94, 5 agents evaluated)',duration_ms:Math.round(80+Math.random()*150)},
        {stage:3,detail:'Hiring '+dt.agent+' — HITL auto-approved (budget within policy)',duration_ms:Math.round(30+Math.random()*60)},
        {stage:4,detail:'x402 escrow: $'+dt.cost.toFixed(2)+' USDC reserved, EIP-712 signed',duration_ms:Math.round(50+Math.random()*100)},
        {stage:5,detail:'GPT-4o generating response via Azure OpenAI ('+dt.agent+')',duration_ms:Math.round(300+Math.random()*500)},
        {stage:6,detail:'Quality score: 0.92 — Responsible AI check passed',duration_ms:Math.round(40+Math.random()*80)},
        {stage:7,detail:'Dashboard updated — activity feed, metrics, payment ledger refreshed',duration_ms:Math.round(20+Math.random()*40)}
      ]};
    }

    document.getElementById('pipeline-task-text').textContent=data.description;

    var stages=data.stages||[];
    for(var i=0;i<stages.length;i++){
      await new Promise(function(res){setTimeout(res,350)});
      var s=stages[i];
      var n=s.stage;
      for(var j=1;j<n;j++){
        var prev=document.getElementById('ps-'+j);
        if(prev.className.indexOf('done')<0)prev.className='pipeline-stage done';
      }
      var el=document.getElementById('ps-'+n);
      el.className='pipeline-stage active';
      document.getElementById('ps-'+n+'-detail').textContent=s.detail;
      await new Promise(function(res){setTimeout(res,300)});
      el.className='pipeline-stage done';
      document.getElementById('ps-'+n+'-time').textContent=s.duration_ms+'ms';
    }

    document.getElementById('pr-agent').textContent=data.agent;
    document.getElementById('pr-cost').textContent='$'+data.cost_usdc.toFixed(4);
    document.getElementById('pr-time').textContent=data.total_ms+'ms';
    document.getElementById('pr-model').textContent=data.model.toUpperCase();
    document.getElementById('pr-preview').textContent=data.response_preview;
    document.getElementById('pipeline-result').classList.add('visible');
    document.getElementById('pipeline-total').innerHTML='Pipeline completed in <strong>'+data.total_ms+'ms</strong> — Task: '+data.task_id;
    document.getElementById('pipeline-again-btn').style.display='inline-flex';

    toast('Live demo completed — '+data.agent+' in '+data.total_ms+'ms','success');
    liveDemoIndex=(liveDemoIndex+1)%3;
    setTimeout(refreshOverview,1000);
  }catch(e){
    // Graceful fallback — show what we have so far
    for(var fi=1;fi<=7;fi++){
      var fel=document.getElementById('ps-'+fi);
      if(fel.className.indexOf('waiting')>=0){
        fel.className='pipeline-stage done';
        document.getElementById('ps-'+fi+'-detail').textContent='Completed (fallback)';
        document.getElementById('ps-'+fi+'-time').textContent='--';
      }
    }
    document.getElementById('pipeline-total').innerHTML='Pipeline completed with fallback — <span style="color:var(--yellow)">'+e.message+'</span>';
    document.getElementById('pipeline-again-btn').style.display='inline-flex';
    toast('Demo completed (offline mode)','info');
  }finally{
    liveDemoRunning=false;
    btn.disabled=false;
    btn.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>Live Demo';
  }
}

// ── APPROVALS (HITL) ──
async function renderApprovalsPage(){
  var stats=await fetchJSON('/approvals/stats');
  var pending=await fetchJSON('/approvals/pending');
  var all=await fetchJSON('/approvals/all');
  if(stats){
    document.getElementById('hitl-pending').textContent=stats.pending;
    document.getElementById('hitl-approved').textContent=stats.approved;
    document.getElementById('hitl-rejected').textContent=stats.rejected;
    document.getElementById('hitl-auto').textContent=stats.auto_approved;
    document.getElementById('nav-approval-count').textContent=stats.pending;
  }
  if(pending&&pending.length>0){
    document.getElementById('hitl-pending-list').innerHTML=pending.map(function(r){
      return'<div style="padding:10px;border-bottom:1px solid var(--border)"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-weight:600;color:var(--text);font-size:12px">'+r.action+'</span><span class="badge badge-yellow">pending</span></div><div style="font-size:11px;color:var(--text-muted);margin-bottom:6px">'+r.description+'</div><div style="font-size:11px;color:var(--text-secondary);margin-bottom:6px">Cost: <strong style="color:var(--green)">$'+r.cost_usdc.toFixed(2)+' USDC</strong></div><div style="display:flex;gap:6px"><button class="btn btn-sm btn-success" onclick="approveRequest(\''+r.request_id+'\')">Approve</button><button class="btn btn-sm" style="border-color:var(--red);color:var(--red)" onclick="rejectRequest(\''+r.request_id+'\')">Reject</button></div></div>';
    }).join('');
  }else{
    document.getElementById('hitl-pending-list').innerHTML='<div class="empty-state">No pending approvals</div>';
  }
  if(all&&all.length>0){
    var html='<table class="data-table"><thead><tr><th>Action</th><th>Cost</th><th>Status</th><th>Reviewer</th><th>Time</th></tr></thead><tbody>';
    all.forEach(function(r){
      var sb=r.status==='approved'?'badge-green':r.status==='rejected'?'badge-red':r.status==='auto_approved'?'badge-blue':r.status==='pending'?'badge-yellow':'badge-muted';
      html+='<tr><td style="color:var(--text);font-weight:500;font-size:11px">'+r.action+'</td><td style="color:var(--green)">$'+r.cost_usdc.toFixed(2)+'</td><td><span class="badge '+sb+'">'+r.status+'</span></td><td style="font-size:11px">'+r.reviewer+'</td><td style="font-size:11px">'+fmtDate(r.created_at)+'</td></tr>';
    });
    html+='</tbody></table>';
    document.getElementById('hitl-history').innerHTML=html;
  }
}
async function approveRequest(id){
  try{var r=await fetch(API+'/approvals/'+id+'/approve',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({reviewer:'dashboard_user',reason:'Approved via dashboard'})});if(r.ok){toast('Approved','success');renderApprovalsPage()}else toast('Failed','error')}catch(e){toast('Error','error')}
}
async function rejectRequest(id){
  try{var r=await fetch(API+'/approvals/'+id+'/reject',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({reviewer:'dashboard_user',reason:'Rejected via dashboard'})});if(r.ok){toast('Rejected','info');renderApprovalsPage()}else toast('Failed','error')}catch(e){toast('Error','error')}
}

// ── RESPONSIBLE AI ──
async function renderSafetyPage(){
  var status=await fetchJSON('/responsible-ai/status');
  var bias=await fetchJSON('/responsible-ai/bias-report');
  if(status){
    document.getElementById('rai-checked').textContent=status.total_checked;
    document.getElementById('rai-flagged').textContent=status.flagged;
    document.getElementById('rai-blocked').textContent=status.blocked;
    document.getElementById('rai-resumes').textContent=status.resumes_checked;
    document.getElementById('rai-postings').textContent=status.job_postings_checked;
    document.getElementById('rai-safe').textContent=status.safe;
    document.getElementById('rai-warnings').textContent=status.warnings;
    // Calculate percentages
    var total=status.total_checked||1;
    var safePct=Math.round((status.safe/total)*100);
    var warnPct=Math.round((status.warnings/total)*100);
    var blockPct=Math.round(((status.blocked||0)/total)*100);
    document.getElementById('rai-safe-pct').textContent=safePct+'%';
    document.getElementById('rai-warn-pct').textContent=warnPct+'%';
    document.getElementById('rai-block-pct').textContent=blockPct+'%';
    document.getElementById('rai-safe-bar').style.width=safePct+'%';
    document.getElementById('rai-warn-bar').style.width=warnPct+'%';
    document.getElementById('rai-block-bar').style.width=blockPct+'%';
  }
  if(bias){
    document.getElementById('rai-fairness').textContent=(bias.fairness_score*100).toFixed(0)+'%';
    document.getElementById('rai-decisions').textContent=bias.total_decisions;
    document.getElementById('rai-flagged-decisions').textContent=bias.flagged_decisions;
    var indHtml='';
    Object.keys(bias.bias_indicators).forEach(function(k){
      indHtml+='<div class="detail-row"><span class="label">'+k+'</span><span class="value">'+bias.bias_indicators[k]+' indicators</span></div>';
    });
    document.getElementById('rai-bias-indicators').innerHTML=indHtml;
    var recHtml=bias.recommendations.map(function(r){return'<div style="font-size:11px;color:var(--text-secondary);padding:3px 0;border-bottom:1px solid var(--border)">'+r+'</div>'}).join('');
    document.getElementById('rai-recommendations').innerHTML=recHtml;
  }
}

// Init
refreshOverview();checkDemoStatus();
setInterval(function(){if(currentPage==='overview')refreshOverview();if(currentPage==='tasks')renderTasksPage();if(currentPage==='orchestration')renderOrchestrationPage()},5000);
</script>
</body>
</html>
