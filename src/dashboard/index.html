<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HireWire Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
  :root {
    --bg: #09090b;
    --bg-secondary: #18181b;
    --card: #1c1c22;
    --card-hover: #232329;
    --border: #27272a;
    --border-active: #3f3f46;
    --accent: #6366f1;
    --accent-light: #818cf8;
    --accent-glow: rgba(99,102,241,0.15);
    --green: #22c55e;
    --green-dim: rgba(34,197,94,0.15);
    --yellow: #eab308;
    --yellow-dim: rgba(234,179,8,0.15);
    --red: #ef4444;
    --red-dim: rgba(239,68,68,0.15);
    --blue: #3b82f6;
    --blue-dim: rgba(59,130,246,0.15);
    --text: #fafafa;
    --text-secondary: #a1a1aa;
    --text-muted: #71717a;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg); color: var(--text);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    font-size: 14px; line-height: 1.5; min-height: 100vh; overflow: hidden;
  }
  .app-layout { display: flex; height: 100vh; }
  .sidebar {
    width: 240px; min-width: 240px; background: var(--bg-secondary);
    border-right: 1px solid var(--border); display: flex; flex-direction: column; height: 100vh; z-index: 10;
  }
  .sidebar-logo { padding: 20px 20px 16px; border-bottom: 1px solid var(--border); }
  .sidebar-logo h1 { font-size: 18px; font-weight: 700; color: var(--text); letter-spacing: -0.02em; }
  .sidebar-logo h1 span { color: var(--accent-light); }
  .sidebar-logo .version { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
  .sidebar-nav { flex: 1; padding: 8px; overflow-y: auto; }
  .nav-section { margin-bottom: 4px; }
  .nav-section-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); padding: 12px 12px 6px; }
  .nav-item { display: flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 6px; cursor: pointer; color: var(--text-secondary); font-size: 13px; font-weight: 500; transition: all 0.15s ease; margin-bottom: 1px; user-select: none; }
  .nav-item:hover { background: var(--card); color: var(--text); }
  .nav-item.active { background: var(--accent-glow); color: var(--accent-light); }
  .nav-item svg { width: 18px; height: 18px; flex-shrink: 0; opacity: 0.7; }
  .nav-item.active svg { opacity: 1; }
  .nav-badge { margin-left: auto; font-size: 10px; font-weight: 600; padding: 1px 6px; border-radius: 10px; background: var(--accent-glow); color: var(--accent-light); }
  .sidebar-footer { padding: 12px 16px; border-top: 1px solid var(--border); }
  .system-status { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-secondary); }
  .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
  .status-dot.offline { background: var(--red); }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
  .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
  .top-bar { display: flex; align-items: center; justify-content: space-between; padding: 12px 24px; border-bottom: 1px solid var(--border); background: var(--bg); min-height: 56px; }
  .top-bar-left { display: flex; align-items: center; gap: 12px; }
  .page-title { font-size: 16px; font-weight: 600; letter-spacing: -0.01em; }
  .top-bar-right { display: flex; align-items: center; gap: 10px; }
  .gpt4o-badge { font-size: 10px; font-weight: 700; padding: 3px 10px; border-radius: 12px; background: var(--green-dim); color: var(--green); text-transform: uppercase; letter-spacing: 0.05em; display: none; }
  .gpt4o-badge.active { display: inline-block; }
  .demo-badge { font-size: 10px; font-weight: 700; padding: 3px 10px; border-radius: 12px; background: var(--yellow-dim); color: var(--yellow); text-transform: uppercase; letter-spacing: 0.05em; display: none; }
  .demo-badge.active { display: inline-block; }
  .btn { display: inline-flex; align-items: center; gap: 6px; padding: 7px 14px; border-radius: 6px; font-size: 13px; font-weight: 500; font-family: inherit; cursor: pointer; border: 1px solid var(--border); background: var(--card); color: var(--text); transition: all 0.15s ease; }
  .btn:hover { background: var(--card-hover); border-color: var(--border-active); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .btn-primary { background: var(--accent); border-color: var(--accent); color: white; }
  .btn-primary:hover { background: var(--accent-light); border-color: var(--accent-light); }
  .btn-sm { padding: 4px 10px; font-size: 12px; }
  .btn-success { background: var(--green); border-color: var(--green); }
  .btn-success:hover { background: #16a34a; border-color: #16a34a; }
  .page-area { flex: 1; overflow-y: auto; padding: 24px; scroll-behavior: smooth; }
  .page { display: none; }
  .page.active { display: block; }
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; transition: border-color 0.15s ease; }
  .card:hover { border-color: var(--border-active); }
  .card-header { padding: 14px 18px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .card-title { font-size: 13px; font-weight: 600; color: var(--text); }
  .card-body { padding: 18px; }
  .card-body-flush { padding: 0; }
  .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 20px; }
  .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 18px; transition: border-color 0.15s ease; }
  .stat-card:hover { border-color: var(--border-active); }
  .stat-label { font-size: 12px; color: var(--text-muted); font-weight: 500; margin-bottom: 6px; }
  .stat-value { font-size: 28px; font-weight: 700; color: var(--text); letter-spacing: -0.02em; line-height: 1.1; }
  .stat-value.accent { color: var(--accent-light); }
  .stat-value.green { color: var(--green); }
  .stat-change { font-size: 11px; font-weight: 500; margin-top: 4px; }
  .stat-change.up { color: var(--green); }
  .stat-change.down { color: var(--red); }
  .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .data-table th { text-align: left; padding: 10px 14px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.2); }
  .data-table td { padding: 10px 14px; border-bottom: 1px solid var(--border); color: var(--text-secondary); }
  .data-table tr:last-child td { border-bottom: none; }
  .data-table tr:hover td { background: rgba(255,255,255,0.02); }
  .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.03em; }
  .badge-green { background: var(--green-dim); color: var(--green); }
  .badge-yellow { background: var(--yellow-dim); color: var(--yellow); }
  .badge-red { background: var(--red-dim); color: var(--red); }
  .badge-blue { background: var(--blue-dim); color: var(--blue); }
  .badge-muted { background: rgba(113,113,122,0.15); color: var(--text-muted); }
  .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; background: var(--bg); color: var(--text-secondary); border: 1px solid var(--border); margin-right: 4px; margin-bottom: 4px; }
  .tag-accent { background: var(--accent-glow); color: var(--accent-light); border-color: transparent; }
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .col-span-2 { grid-column: span 2; }
  .activity-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
  .activity-item:last-child { border-bottom: none; }
  .activity-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 14px; }
  .activity-icon.green { background: var(--green-dim); color: var(--green); }
  .activity-icon.blue { background: var(--blue-dim); color: var(--blue); }
  .activity-icon.yellow { background: var(--yellow-dim); color: var(--yellow); }
  .activity-icon.accent { background: var(--accent-glow); color: var(--accent-light); }
  .activity-text { flex: 1; font-size: 13px; color: var(--text-secondary); line-height: 1.4; }
  .activity-text strong { color: var(--text); font-weight: 600; }
  .activity-time { font-size: 11px; color: var(--text-muted); white-space: nowrap; flex-shrink: 0; }
  .agent-row { display: flex; align-items: center; gap: 14px; padding: 14px 18px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.1s ease; }
  .agent-row:last-child { border-bottom: none; }
  .agent-row:hover { background: rgba(255,255,255,0.02); }
  .agent-row.selected { background: var(--accent-glow); }
  .agent-avatar { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 700; flex-shrink: 0; }
  .agent-info { flex: 1; min-width: 0; }
  .agent-name { font-weight: 600; font-size: 14px; color: var(--text); }
  .agent-desc { font-size: 12px; color: var(--text-muted); margin-top: 1px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .agent-stats { display: flex; gap: 16px; flex-shrink: 0; }
  .agent-stat-item { text-align: right; }
  .agent-stat-value { font-size: 14px; font-weight: 600; color: var(--text); }
  .agent-stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
  .detail-panel { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 10px; padding: 20px; }
  .detail-section { margin-bottom: 16px; }
  .detail-section-title { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: 8px; }
  .detail-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; border-bottom: 1px solid var(--border); }
  .detail-row:last-child { border-bottom: none; }
  .detail-row .label { color: var(--text-muted); }
  .detail-row .value { color: var(--text); font-weight: 500; }
  .quick-action { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: all 0.15s ease; font-size: 13px; color: var(--text-secondary); }
  .quick-action:hover { border-color: var(--accent); color: var(--text); background: var(--accent-glow); }
  .quick-action svg { width: 20px; height: 20px; color: var(--accent-light); flex-shrink: 0; }
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 100; backdrop-filter: blur(4px); }
  .modal-overlay.active { display: flex; }
  .modal { background: var(--card); border: 1px solid var(--border); border-radius: 12px; width: 480px; max-width: 90vw; max-height: 80vh; overflow-y: auto; }
  .modal-header { padding: 18px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .modal-title { font-size: 15px; font-weight: 600; }
  .modal-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; padding: 4px; }
  .modal-close:hover { color: var(--text); }
  .modal-body { padding: 20px; }
  .modal-footer { padding: 14px 20px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }
  .form-group { margin-bottom: 14px; }
  .form-label { display: block; font-size: 12px; font-weight: 500; color: var(--text-secondary); margin-bottom: 5px; }
  .form-input { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 8px 12px; color: var(--text); font-family: inherit; font-size: 13px; outline: none; transition: border-color 0.15s; }
  .form-input:focus { border-color: var(--accent); }
  .form-input::placeholder { color: var(--text-muted); }
  .chart-container { position: relative; height: 240px; width: 100%; }
  .empty-state { text-align: center; padding: 40px 20px; color: var(--text-muted); font-size: 13px; }
  .flow-step { display: flex; align-items: center; gap: 12px; padding: 10px 14px; position: relative; }
  .flow-step:not(:last-child)::after { content: ''; position: absolute; left: 25px; bottom: -4px; width: 2px; height: 8px; background: var(--border); }
  .flow-dot { width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--accent); flex-shrink: 0; }
  .flow-dot.filled { background: var(--accent); }
  .flow-text { font-size: 12px; color: var(--text-secondary); }
  .flow-text strong { color: var(--text); }
  .response-preview { font-size: 12px; color: var(--text-muted); background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 8px 12px; margin-top: 6px; line-height: 1.4; max-height: 80px; overflow: hidden; }
  .gpt4o-tag { display: inline-block; padding: 1px 6px; border-radius: 3px; font-size: 9px; font-weight: 700; background: var(--green-dim); color: var(--green); letter-spacing: 0.05em; margin-left: 6px; }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--border-active); }
  .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 200; display: flex; flex-direction: column; gap: 8px; }
  .toast { padding: 10px 16px; background: var(--card); border: 1px solid var(--border); border-radius: 8px; font-size: 13px; color: var(--text-secondary); box-shadow: 0 8px 24px rgba(0,0,0,0.4); animation: slideIn 0.3s ease; }
  .toast.success { border-left: 3px solid var(--green); }
  .toast.error { border-left: 3px solid var(--red); }
  .toast.info { border-left: 3px solid var(--accent); }
  @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
  .budget-meter { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
  .budget-bar { flex: 1; height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; }
  .budget-bar .fill { height: 100%; background: var(--accent); border-radius: 5px; transition: width 0.3s ease; }
  .budget-labels { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); }
  .escrow-bar { display: flex; align-items: center; gap: 12px; padding: 10px 14px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; }
  .escrow-bar-fill { flex: 1; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
  .escrow-bar-fill .fill { height: 100%; border-radius: 3px; transition: width 0.3s ease; }
  .kb-entry { padding: 14px 18px; border-bottom: 1px solid var(--border); }
  .kb-entry:last-child { border-bottom: none; }
  .kb-entry-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
  .kb-entry-text { font-size: 12px; color: var(--text-muted); line-height: 1.5; }
  .kb-entry-meta { display: flex; gap: 10px; margin-top: 6px; }
  /* Live Demo Pipeline Overlay */
  .pipeline-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.75); display: none; align-items: center; justify-content: center; z-index: 150; backdrop-filter: blur(6px); }
  .pipeline-overlay.active { display: flex; }
  .pipeline-panel { background: var(--card); border: 1px solid var(--border); border-radius: 14px; width: 620px; max-width: 92vw; max-height: 85vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }
  .pipeline-header { padding: 20px 24px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .pipeline-header h2 { font-size: 17px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 10px; }
  .pipeline-header .live-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--green); animation: pulse 1.5s infinite; }
  .pipeline-body { padding: 20px 24px; }
  .pipeline-task { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 14px 16px; margin-bottom: 20px; }
  .pipeline-task-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: 4px; }
  .pipeline-task-text { font-size: 14px; color: var(--text); font-weight: 500; line-height: 1.4; }
  .pipeline-stages { display: flex; flex-direction: column; gap: 0; }
  .pipeline-stage { display: flex; align-items: flex-start; gap: 14px; padding: 12px 0; position: relative; }
  .pipeline-stage:not(:last-child) { border-bottom: none; }
  .pipeline-stage-line { position: absolute; left: 15px; top: 36px; bottom: -12px; width: 2px; background: var(--border); }
  .pipeline-stage:last-child .pipeline-stage-line { display: none; }
  .pipeline-stage-dot { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 13px; transition: all 0.4s ease; z-index: 1; background: var(--bg); }
  .pipeline-stage.waiting .pipeline-stage-dot { border-color: var(--border); color: var(--text-muted); }
  .pipeline-stage.active .pipeline-stage-dot { border-color: var(--accent); color: var(--accent-light); background: var(--accent-glow); animation: pulse 1s infinite; }
  .pipeline-stage.done .pipeline-stage-dot { border-color: var(--green); color: var(--green); background: var(--green-dim); }
  .pipeline-stage.done .pipeline-stage-line { background: var(--green); }
  .pipeline-stage-content { flex: 1; min-width: 0; }
  .pipeline-stage-name { font-size: 13px; font-weight: 600; color: var(--text-muted); transition: color 0.3s; }
  .pipeline-stage.active .pipeline-stage-name, .pipeline-stage.done .pipeline-stage-name { color: var(--text); }
  .pipeline-stage-detail { font-size: 12px; color: var(--text-muted); margin-top: 2px; line-height: 1.4; opacity: 0; transition: opacity 0.4s; }
  .pipeline-stage.active .pipeline-stage-detail, .pipeline-stage.done .pipeline-stage-detail { opacity: 1; }
  .pipeline-stage-time { font-size: 11px; color: var(--text-muted); flex-shrink: 0; opacity: 0; transition: opacity 0.3s; }
  .pipeline-stage.done .pipeline-stage-time { opacity: 1; color: var(--green); }
  .pipeline-result { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 14px 16px; margin-top: 16px; display: none; }
  .pipeline-result.visible { display: block; animation: slideIn 0.3s ease; }
  .pipeline-result-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
  .pipeline-result-title { font-size: 13px; font-weight: 600; color: var(--green); }
  .pipeline-result-stats { display: flex; gap: 16px; }
  .pipeline-result-stat { text-align: center; }
  .pipeline-result-stat-value { font-size: 16px; font-weight: 700; color: var(--text); }
  .pipeline-result-stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
  .pipeline-result-preview { font-size: 12px; color: var(--text-secondary); line-height: 1.5; margin-top: 10px; background: var(--card); border: 1px solid var(--border); border-radius: 6px; padding: 10px 12px; max-height: 120px; overflow-y: auto; }
  .pipeline-footer { padding: 14px 24px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  .pipeline-total { font-size: 13px; color: var(--text-muted); }
  .pipeline-total strong { color: var(--text); }
</style>
</head>
<body>
<div class="app-layout">
  <aside class="sidebar">
    <div class="sidebar-logo"><h1>Hire<span>Wire</span></h1><div class="version">v2.0 &middot; Microsoft AI Dev Days</div></div>
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-label">Platform</div>
        <div class="nav-item active" data-page="overview" onclick="navigateTo('overview')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>Overview</div>
        <div class="nav-item" data-page="agents" onclick="navigateTo('agents')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>Agents<span class="nav-badge" id="nav-agent-count">5</span></div>
        <div class="nav-item" data-page="tasks" onclick="navigateTo('tasks')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Tasks<span class="nav-badge" id="nav-task-count">0</span></div>
      </div>
      <div class="nav-section">
        <div class="nav-section-label">Finance</div>
        <div class="nav-item" data-page="payments" onclick="navigateTo('payments')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>Payments</div>
      </div>
      <div class="nav-section">
        <div class="nav-section-label">Intelligence</div>
        <div class="nav-item" data-page="metrics" onclick="navigateTo('metrics')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>Metrics</div>
      </div>
      <div class="nav-section">
        <div class="nav-section-label">Governance</div>
        <div class="nav-item" data-page="approvals" onclick="navigateTo('approvals')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>Approvals<span class="nav-badge" id="nav-approval-count">0</span></div>
        <div class="nav-item" data-page="safety" onclick="navigateTo('safety')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Responsible AI</div>
      </div>
    </nav>
    <div class="sidebar-footer"><div class="system-status"><div class="status-dot" id="sidebar-status-dot"></div><span id="sidebar-status-text">connecting...</span></div></div>
  </aside>
  <div class="main-content">
    <div class="top-bar">
      <div class="top-bar-left"><span class="page-title" id="page-title">Overview</span><span class="gpt4o-badge" id="gpt4o-badge">GPT-4o LIVE</span><span class="demo-badge" id="demo-badge">DEMO MODE</span></div>
      <div class="top-bar-right">
        <button class="btn btn-sm btn-success" id="live-demo-btn" onclick="runLiveDemo()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>Live Demo</button>
        <button class="btn btn-sm" id="demo-btn" onclick="toggleDemo()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>Auto Demo</button>
        <button class="btn btn-sm btn-primary" onclick="openTaskModal()"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>New Task</button>
      </div>
    </div>
    <div class="page-area">
      <!-- OVERVIEW -->
      <div class="page active" id="page-overview">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Agents</div><div class="stat-value accent" id="stat-agents">--</div><div class="stat-change up" id="stat-agents-sub">3 internal + 2 external</div></div>
          <div class="stat-card"><div class="stat-label">Tasks Completed</div><div class="stat-value green" id="stat-completed">--</div><div class="stat-change up" id="stat-completion-rate">--</div></div>
          <div class="stat-card"><div class="stat-label">Total Tasks</div><div class="stat-value" id="stat-jobs">--</div><div class="stat-change" id="stat-running-info">--</div></div>
          <div class="stat-card"><div class="stat-label">USDC Spent</div><div class="stat-value green" id="stat-spent">--</div><div class="stat-change up">via x402 protocol</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><div class="card-header"><span class="card-title">Live Activity Feed</span><span style="font-size:11px;color:var(--text-muted)" id="activity-source">Real-time from API</span></div><div class="card-body" id="activity-feed" style="max-height:420px;overflow-y:auto"><div class="empty-state">Loading...</div></div></div>
          <div>
            <div class="card" style="margin-bottom:16px"><div class="card-header"><span class="card-title">Agent Performance</span></div><div class="card-body"><div class="chart-container" style="height:180px"><canvas id="overview-perf-chart"></canvas></div></div></div>
            <div class="card"><div class="card-header"><span class="card-title">Submit Task</span></div><div class="card-body"><input class="form-input" id="inline-task-input" placeholder="Describe a task for the CEO agent..." style="margin-bottom:8px"/><div style="display:flex;gap:8px"><input class="form-input" id="inline-budget-input" type="number" value="1.0" min="0.01" max="100" step="0.01" style="width:100px" placeholder="USDC"/><button class="btn btn-primary" id="submit-btn" style="flex:1" onclick="submitInlineTask()">Submit to CEO</button></div></div></div>
          </div>
        </div>
      </div>
      <!-- AGENTS -->
      <div class="page" id="page-agents">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Registered Agents</div><div class="stat-value accent" id="agents-total">--</div></div>
          <div class="stat-card"><div class="stat-label">Internal</div><div class="stat-value" id="agents-internal">--</div></div>
          <div class="stat-card"><div class="stat-label">External (x402)</div><div class="stat-value green" id="agents-external">--</div></div>
          <div class="stat-card"><div class="stat-label">Avg Price</div><div class="stat-value" id="agents-avg-price">--</div></div>
        </div>
        <div class="grid-2" style="grid-template-columns:1fr 380px">
          <div class="card"><div class="card-header"><span class="card-title">Agent Roster</span></div><div class="card-body-flush" id="agent-list"><div class="empty-state">Loading agents...</div></div></div>
          <div id="agent-detail" class="detail-panel"><div class="empty-state" style="padding:60px 20px">Select an agent to view details</div></div>
        </div>
      </div>
      <!-- TASKS -->
      <div class="page" id="page-tasks">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Tasks</div><div class="stat-value accent" id="tasks-total">--</div></div>
          <div class="stat-card"><div class="stat-label">Completed</div><div class="stat-value green" id="tasks-completed">--</div></div>
          <div class="stat-card"><div class="stat-label">Running</div><div class="stat-value" style="color:var(--yellow)" id="tasks-running">--</div></div>
          <div class="stat-card"><div class="stat-label">GPT-4o Responses</div><div class="stat-value" style="color:var(--green)" id="tasks-gpt4o">--</div></div>
        </div>
        <div class="card"><div class="card-header"><span class="card-title">Task History</span><span style="font-size:11px;color:var(--text-muted)">Showing agent responses from GPT-4o</span></div><div class="card-body-flush" id="task-table" style="max-height:500px;overflow-y:auto"><div class="empty-state">Loading tasks...</div></div></div>
      </div>
      <!-- PAYMENTS -->
      <div class="page" id="page-payments">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Payments</div><div class="stat-value accent" id="pay-total">--</div></div>
          <div class="stat-card"><div class="stat-label">Total Spent</div><div class="stat-value" id="pay-spent">--</div></div>
          <div class="stat-card"><div class="stat-label">External (x402)</div><div class="stat-value" style="color:var(--yellow)" id="pay-external">--</div></div>
          <div class="stat-card"><div class="stat-label">Agents Paid</div><div class="stat-value green" id="pay-agents-paid">--</div></div>
        </div>
        <div class="grid-2" style="margin-bottom:20px">
          <div class="card"><div class="card-header"><span class="card-title">Spending by Agent</span></div><div class="card-body"><div class="chart-container" style="height:200px"><canvas id="pay-spend-chart"></canvas></div></div></div>
          <div class="card"><div class="card-header"><span class="card-title">x402 Payment Protocol</span></div><div class="card-body">
            <div class="flow-step"><div class="flow-dot filled"></div><div class="flow-text"><strong>1. Task Submission</strong> &mdash; CEO receives task and analyzes it</div></div>
            <div class="flow-step"><div class="flow-dot filled"></div><div class="flow-text"><strong>2. Agent Discovery</strong> &mdash; Find best agent via skill matching</div></div>
            <div class="flow-step"><div class="flow-dot filled"></div><div class="flow-text"><strong>3. Budget Allocation</strong> &mdash; Reserve USDC from task budget</div></div>
            <div class="flow-step"><div class="flow-dot filled"></div><div class="flow-text"><strong>4. x402 Payment</strong> &mdash; Create USDC payment proof to agent</div></div>
            <div class="flow-step"><div class="flow-dot filled"></div><div class="flow-text"><strong>5. Agent Execution</strong> &mdash; Agent performs work (GPT-4o)</div></div>
            <div class="flow-step"><div class="flow-dot"></div><div class="flow-text"><strong>6. Settlement</strong> &mdash; Payment released on task completion</div></div>
          </div></div>
        </div>
        <div class="card"><div class="card-header"><span class="card-title">Payment Log</span><span style="font-size:11px;color:var(--text-muted)" id="pay-count-label">0 transactions</span></div><div class="card-body-flush" id="payment-table" style="max-height:400px;overflow-y:auto"><div class="empty-state">No transactions yet.</div></div></div>
      </div>
      <!-- METRICS -->
      <div class="page" id="page-metrics">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Total Spend</div><div class="stat-value" id="m-total-spend">--</div></div>
          <div class="stat-card"><div class="stat-label">Completion Rate</div><div class="stat-value green" id="m-success-rate">--</div></div>
          <div class="stat-card"><div class="stat-label">Avg Response</div><div class="stat-value accent" id="m-avg-response">--</div></div>
          <div class="stat-card"><div class="stat-label">GPT-4o Tasks</div><div class="stat-value" id="m-gpt4o">--</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><div class="card-header"><span class="card-title">Agent Performance</span></div><div class="card-body"><div class="chart-container"><canvas id="perf-chart"></canvas></div></div></div>
          <div class="card"><div class="card-header"><span class="card-title">Spending by Agent</span></div><div class="card-body"><div class="chart-container"><canvas id="spend-by-agent-chart"></canvas></div></div></div>
        </div>
      </div>
      <!-- APPROVALS (HITL) -->
      <div class="page" id="page-approvals">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Pending</div><div class="stat-value" style="color:var(--yellow)" id="hitl-pending">--</div></div>
          <div class="stat-card"><div class="stat-label">Approved</div><div class="stat-value green" id="hitl-approved">--</div></div>
          <div class="stat-card"><div class="stat-label">Rejected</div><div class="stat-value" style="color:var(--red)" id="hitl-rejected">--</div></div>
          <div class="stat-card"><div class="stat-label">Auto-Approved</div><div class="stat-value accent" id="hitl-auto">--</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><div class="card-header"><span class="card-title">Pending Approvals</span><span style="font-size:11px;color:var(--text-muted)">Human-in-the-Loop</span></div><div class="card-body" id="hitl-pending-list" style="max-height:400px;overflow-y:auto"><div class="empty-state">No pending approvals</div></div></div>
          <div class="card"><div class="card-header"><span class="card-title">Approval History</span></div><div class="card-body-flush" id="hitl-history" style="max-height:400px;overflow-y:auto"><div class="empty-state">No approval history</div></div></div>
        </div>
      </div>
      <!-- RESPONSIBLE AI -->
      <div class="page" id="page-safety">
        <div class="stat-grid">
          <div class="stat-card"><div class="stat-label">Items Checked</div><div class="stat-value accent" id="rai-checked">--</div></div>
          <div class="stat-card"><div class="stat-label">Flagged</div><div class="stat-value" style="color:var(--yellow)" id="rai-flagged">--</div></div>
          <div class="stat-card"><div class="stat-label">Blocked</div><div class="stat-value" style="color:var(--red)" id="rai-blocked">--</div></div>
          <div class="stat-card"><div class="stat-label">Fairness Score</div><div class="stat-value green" id="rai-fairness">--</div></div>
        </div>
        <div class="grid-2">
          <div class="card"><div class="card-header"><span class="card-title">Content Safety Status</span></div><div class="card-body" id="rai-status-panel">
            <div class="detail-section">
              <div class="detail-row"><span class="label">Resumes Checked</span><span class="value" id="rai-resumes">0</span></div>
              <div class="detail-row"><span class="label">Job Postings Checked</span><span class="value" id="rai-postings">0</span></div>
              <div class="detail-row"><span class="label">Safe</span><span class="value" style="color:var(--green)" id="rai-safe">0</span></div>
              <div class="detail-row"><span class="label">Warnings</span><span class="value" style="color:var(--yellow)" id="rai-warnings">0</span></div>
              <div class="detail-row"><span class="label">Flagged Rate</span><span class="value" id="rai-flag-rate">0%</span></div>
            </div>
          </div></div>
          <div class="card"><div class="card-header"><span class="card-title">Bias Report</span></div><div class="card-body" id="rai-bias-panel">
            <div class="detail-section">
              <div class="detail-row"><span class="label">Total Decisions</span><span class="value" id="rai-decisions">0</span></div>
              <div class="detail-row"><span class="label">Flagged Decisions</span><span class="value" id="rai-flagged-decisions">0</span></div>
              <div id="rai-bias-indicators"></div>
              <div id="rai-recommendations" style="margin-top:12px"></div>
            </div>
          </div></div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- MODALS -->
<div class="modal-overlay" id="task-modal"><div class="modal"><div class="modal-header"><span class="modal-title">Submit New Task</span><button class="modal-close" onclick="closeTaskModal()">&times;</button></div><div class="modal-body"><div class="form-group"><label class="form-label">Task Description</label><input class="form-input" id="modal-task-input" placeholder="e.g. Analyze competitor pricing for AI agent platforms..." maxlength="2000"/></div><div class="form-group"><label class="form-label">Budget (USDC)</label><input class="form-input" id="modal-budget-input" type="number" value="2.0" min="0.01" max="1000" step="0.01"/></div><div style="font-size:11px;color:var(--text-muted);margin-top:8px">Task will be routed to the best agent by the CEO. GPT-4o generates the response. x402 payment recorded.</div></div><div class="modal-footer"><button class="btn" onclick="closeTaskModal()">Cancel</button><button class="btn btn-primary" id="modal-submit-btn" onclick="submitModalTask()">Submit Task</button></div></div></div>
<!-- LIVE DEMO PIPELINE OVERLAY -->
<div class="pipeline-overlay" id="pipeline-overlay">
  <div class="pipeline-panel">
    <div class="pipeline-header">
      <h2><div class="live-dot"></div>Live Pipeline</h2>
      <button class="modal-close" onclick="closePipeline()">&times;</button>
    </div>
    <div class="pipeline-body">
      <div class="pipeline-task">
        <div class="pipeline-task-label">Task</div>
        <div class="pipeline-task-text" id="pipeline-task-text">Preparing...</div>
      </div>
      <div class="pipeline-stages" id="pipeline-stages">
        <div class="pipeline-stage waiting" id="ps-1"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">1</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Task Received</div><div class="pipeline-stage-detail" id="ps-1-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-1-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-2"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">2</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Agent Discovery</div><div class="pipeline-stage-detail" id="ps-2-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-2-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-3"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">3</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Budget Allocation</div><div class="pipeline-stage-detail" id="ps-3-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-3-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-4"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">4</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">GPT-4o Execution</div><div class="pipeline-stage-detail" id="ps-4-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-4-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-5"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">5</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Payment Settlement</div><div class="pipeline-stage-detail" id="ps-5-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-5-time"></div></div>
        <div class="pipeline-stage waiting" id="ps-6"><div class="pipeline-stage-line"></div><div class="pipeline-stage-dot">6</div><div class="pipeline-stage-content"><div class="pipeline-stage-name">Result Delivered</div><div class="pipeline-stage-detail" id="ps-6-detail">Waiting...</div></div><div class="pipeline-stage-time" id="ps-6-time"></div></div>
      </div>
      <div class="pipeline-result" id="pipeline-result">
        <div class="pipeline-result-header">
          <div class="pipeline-result-title">Pipeline Complete</div>
          <div class="pipeline-result-stats">
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-agent">--</div><div class="pipeline-result-stat-label">Agent</div></div>
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-cost">--</div><div class="pipeline-result-stat-label">Cost</div></div>
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-time">--</div><div class="pipeline-result-stat-label">Time</div></div>
            <div class="pipeline-result-stat"><div class="pipeline-result-stat-value" id="pr-model">--</div><div class="pipeline-result-stat-label">Model</div></div>
          </div>
        </div>
        <div class="pipeline-result-preview" id="pr-preview"></div>
      </div>
    </div>
    <div class="pipeline-footer">
      <div class="pipeline-total" id="pipeline-total">Starting pipeline...</div>
      <button class="btn btn-sm btn-primary" id="pipeline-again-btn" style="display:none" onclick="runLiveDemo()">Run Again</button>
    </div>
  </div>
</div>
<div class="toast-container" id="toast-container"></div>
<script>
var API=window.location.origin,currentPage='overview',selectedAgent=null,demoRunning=false,chartInstances={},cachedAgents=[],cachedStats=null;

function fmt(ts){if(!ts)return'--';var d=new Date(ts*1000);return d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
function fmtDate(ts){if(!ts)return'--';var d=new Date(ts*1000);return d.toLocaleDateString([],{month:'short',day:'numeric'})+' '+d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
function toast(msg,type){type=type||'info';var c=document.getElementById('toast-container'),el=document.createElement('div');el.className='toast '+type;el.textContent=msg;c.appendChild(el);setTimeout(function(){el.style.animation='fadeOut 0.3s ease';setTimeout(function(){el.remove()},300)},3000);}
async function fetchJSON(path){try{var r=await fetch(API+path);if(!r.ok)return null;return await r.json()}catch(e){return null}}

function navigateTo(page){
  currentPage=page;
  document.querySelectorAll('.nav-item').forEach(function(el){el.classList.toggle('active',el.dataset.page===page)});
  document.querySelectorAll('.page').forEach(function(el){el.classList.toggle('active',el.id==='page-'+page)});
  var titles={overview:'Overview',agents:'Agents',tasks:'Tasks',payments:'Payments',metrics:'Metrics',approvals:'Approvals (HITL)',safety:'Responsible AI'};
  document.getElementById('page-title').textContent=titles[page]||page;
  if(page==='agents')renderAgentsPage();
  if(page==='tasks')renderTasksPage();
  if(page==='payments')renderPaymentsPage();
  if(page==='metrics')renderMetricsPage();
  if(page==='approvals')renderApprovalsPage();
  if(page==='safety')renderSafetyPage();
}
function openTaskModal(){document.getElementById('task-modal').classList.add('active');document.getElementById('modal-task-input').focus();}
function closeTaskModal(){document.getElementById('task-modal').classList.remove('active');}

async function submitModalTask(){
  var input=document.getElementById('modal-task-input'),budget=document.getElementById('modal-budget-input'),btn=document.getElementById('modal-submit-btn'),desc=input.value.trim();
  if(!desc)return;btn.disabled=true;btn.textContent='Submitting...';
  try{var r=await fetch(API+'/tasks',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({description:desc,budget:parseFloat(budget.value)||1.0})});
  if(r.ok){toast('Task submitted to CEO agent','success');input.value='';closeTaskModal();setTimeout(refreshOverview,2000)}else toast('Failed','error')}
  catch(e){toast('Network error','error')}finally{btn.disabled=false;btn.textContent='Submit Task'}}

async function submitInlineTask(){
  var input=document.getElementById('inline-task-input'),budgetInput=document.getElementById('inline-budget-input'),desc=input.value.trim();if(!desc)return;
  var budget=parseFloat(budgetInput.value)||1.0;
  try{var r=await fetch(API+'/tasks',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({description:desc,budget:budget})});
  if(r.ok){toast('Task submitted to CEO agent','success');input.value='';setTimeout(refreshOverview,2000)}else toast('Failed','error')}
  catch(e){toast('Network error','error')}}

document.getElementById('modal-task-input').addEventListener('keydown',function(e){if(e.key==='Enter')submitModalTask()});
document.getElementById('inline-task-input').addEventListener('keydown',function(e){if(e.key==='Enter')submitInlineTask()});

// ── OVERVIEW ──
async function refreshOverview(){
  var res=await Promise.all([fetchJSON('/health'),fetchJSON('/stats'),fetchJSON('/activity')]);
  var h=res[0],stats=res[1],activity=res[2];
  cachedStats=stats;

  if(h){
    document.getElementById('stat-agents').textContent=h.agents_count;
    document.getElementById('stat-completed').textContent=h.tasks_completed;
    document.getElementById('stat-jobs').textContent=h.tasks_total;
    document.getElementById('stat-spent').textContent='$'+(h.total_spent_usdc||0).toFixed(2);
    document.getElementById('nav-agent-count').textContent=h.agents_count;
    document.getElementById('nav-task-count').textContent=h.tasks_total;
    document.getElementById('sidebar-status-dot').classList.remove('offline');
    document.getElementById('sidebar-status-text').textContent=h.gpt4o_available?'GPT-4o Connected':'All systems healthy';
    if(h.gpt4o_available)document.getElementById('gpt4o-badge').classList.add('active');
    var rate=h.tasks_total>0?Math.round(h.tasks_completed/h.tasks_total*100):0;
    document.getElementById('stat-completion-rate').textContent=rate+'% completion rate';
    document.getElementById('stat-running-info').textContent=h.tasks_running+' running, '+h.tasks_pending+' pending';
    document.getElementById('stat-running-info').className='stat-change'+(h.tasks_running>0?' up':'');
  } else {
    document.getElementById('sidebar-status-dot').classList.add('offline');
    document.getElementById('sidebar-status-text').textContent='Offline mode';
  }

  if(stats){
    document.getElementById('stat-agents-sub').textContent=(stats.agents_count-(stats.agent_spend?Object.keys(stats.agent_spend).filter(function(k){return k.startsWith('designer')||k.startsWith('analyst')}).length:0))+' internal + '+(stats.agents_count>3?stats.agents_count-3:0)+' external';
  }

  // Activity feed from API
  if(activity&&activity.length>0){
    document.getElementById('activity-source').textContent='Live from API ('+activity.length+' events)';
    document.getElementById('activity-feed').innerHTML=activity.map(function(a){
      return'<div class="activity-item"><div class="activity-icon '+a.type+'">'+a.icon+'</div><div class="activity-text">'+a.text+'</div><div class="activity-time">'+a.time+'</div></div>';
    }).join('');
  }

  // Update HITL approval count in nav
  var hitlStats=await fetchJSON('/approvals/stats');
  if(hitlStats){document.getElementById('nav-approval-count').textContent=hitlStats.pending}

  // Overview perf chart
  if(stats&&stats.agent_spend){renderOverviewChart(stats.agent_spend)}
}

function renderOverviewChart(agentSpend){
  var ctx=document.getElementById('overview-perf-chart');if(!ctx)return;
  if(chartInstances.ovPerf)chartInstances.ovPerf.destroy();
  var labels=Object.keys(agentSpend).map(function(k){return k.replace(/-ext-\d+/,'')});
  var values=Object.values(agentSpend);
  chartInstances.ovPerf=new Chart(ctx,{type:'doughnut',data:{labels:labels,datasets:[{data:values,backgroundColor:['#6366f1','#22c55e','#3b82f6','#eab308','#ef4444','#a855f7'],borderColor:'#1c1c22',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#a1a1aa',font:{size:11},padding:8}}}}});
}

// ── AGENTS ──
async function renderAgentsPage(){
  var agents=await fetchJSON('/agents');
  if(!agents)return;
  cachedAgents=agents;
  var el=document.getElementById('agent-list');
  var internal=agents.filter(function(a){return!a.is_external}).length;
  var external=agents.filter(function(a){return a.is_external}).length;
  document.getElementById('agents-total').textContent=agents.length;
  document.getElementById('agents-internal').textContent=internal;
  document.getElementById('agents-external').textContent=external;
  var prices=agents.filter(function(a){return a.is_external}).map(function(a){return parseFloat(a.price_per_call.replace('$',''))||0});
  var avgPrice=prices.length>0?(prices.reduce(function(s,p){return s+p},0)/prices.length):0;
  document.getElementById('agents-avg-price').textContent='$'+avgPrice.toFixed(2);

  var colors={builder:'var(--accent-glow)',research:'var(--green-dim)',designer:'var(--blue-dim)',analyst:'var(--yellow-dim)'};
  var textColors={builder:'var(--accent-light)',research:'var(--green)',designer:'var(--blue)',analyst:'var(--yellow)'};
  el.innerHTML=agents.map(function(a,i){
    var key=a.name.split('-')[0];
    var bg=colors[key]||'var(--accent-glow)';var tc=textColors[key]||'var(--accent-light)';
    return'<div class="agent-row'+(selectedAgent===i?' selected':'')+'" onclick="selectAgent('+i+')"><div class="agent-avatar" style="background:'+bg+';color:'+tc+'">'+a.name[0].toUpperCase()+'</div><div class="agent-info"><div class="agent-name">'+a.name+(a.is_external?' <span class="gpt4o-tag">x402</span>':'')+'</div><div class="agent-desc">'+a.description+'</div></div><div class="agent-stats"><div class="agent-stat-item"><div class="agent-stat-value" style="color:var(--green)">'+a.price_per_call+'</div><div class="agent-stat-label">Price</div></div><div class="agent-stat-item"><span class="badge '+(a.is_external?'badge-yellow':'badge-green')+'">'+(a.is_external?'external':'internal')+'</span></div></div></div>';
  }).join('');
  if(selectedAgent!==null&&cachedAgents[selectedAgent])renderAgentDetail(selectedAgent);
}
function selectAgent(i){selectedAgent=i;renderAgentsPage();}
function renderAgentDetail(i){
  var a=cachedAgents[i];if(!a)return;
  document.getElementById('agent-detail').innerHTML='<div style="display:flex;align-items:center;gap:14px;margin-bottom:20px"><div class="agent-avatar" style="background:var(--accent-glow);color:var(--accent-light);width:48px;height:48px;font-size:20px">'+a.name[0].toUpperCase()+'</div><div><div style="font-size:16px;font-weight:700">'+a.name+'</div><div style="font-size:12px;color:var(--text-muted)">'+a.description+'</div></div></div><div class="detail-section"><div class="detail-section-title">Skills</div><div>'+a.skills.map(function(s){return'<span class="tag tag-accent">'+s+'</span>'}).join('')+'</div></div><div class="detail-section"><div class="detail-section-title">Configuration</div><div class="detail-row"><span class="label">Protocol</span><span class="value">'+a.protocol.toUpperCase()+'</span></div><div class="detail-row"><span class="label">Payment</span><span class="value">'+a.payment+'</span></div><div class="detail-row"><span class="label">Price</span><span class="value" style="color:var(--green)">'+a.price_per_call+'</span></div><div class="detail-row"><span class="label">Endpoint</span><span class="value" style="font-size:11px">'+a.endpoint+'</span></div><div class="detail-row"><span class="label">Type</span><span class="value">'+(a.is_external?'External (x402 paid)':'Internal (free)')+'</span></div></div>';
}

// ── TASKS ──
async function renderTasksPage(){
  var tasks=await fetchJSON('/tasks');if(!tasks)return;
  var completed=tasks.filter(function(t){return t.status==='completed'}).length;
  var running=tasks.filter(function(t){return t.status==='running'}).length;
  var gpt4o=tasks.filter(function(t){return t.result&&t.result.model==='gpt-4o'}).length;
  document.getElementById('tasks-total').textContent=tasks.length;
  document.getElementById('tasks-completed').textContent=completed;
  document.getElementById('tasks-running').textContent=running;
  document.getElementById('tasks-gpt4o').textContent=gpt4o;

  var html='<table class="data-table"><thead><tr><th>Time</th><th>Task</th><th>Agent</th><th>Model</th><th>Response</th><th>Status</th></tr></thead><tbody>';
  tasks.forEach(function(t){
    var r=t.result||{};
    var sb=t.status==='completed'?'badge-green':t.status==='running'?'badge-yellow':t.status==='failed'?'badge-red':'badge-muted';
    var agent=r.assigned_agent||r.task_type||'ceo';
    var model=r.model||'--';
    var modelBadge=model==='gpt-4o'?'<span class="gpt4o-tag">GPT-4o</span>':'<span class="badge badge-muted">'+model+'</span>';
    var preview=r.agent_response_preview||'';
    var responseHtml=preview?'<div class="response-preview">'+preview+'</div>':'<span style="color:var(--text-muted)">--</span>';
    html+='<tr><td>'+fmtDate(t.created_at)+'</td><td style="color:var(--text);font-weight:500;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+t.description+'</td><td>'+agent+'</td><td>'+modelBadge+'</td><td style="max-width:300px">'+responseHtml+'</td><td><span class="badge '+sb+'">'+t.status+'</span></td></tr>';
  });
  html+='</tbody></table>';
  document.getElementById('task-table').innerHTML=html;
}

// ── PAYMENTS ──
async function renderPaymentsPage(){
  var txs=await fetchJSON('/transactions');if(!txs)txs=[];
  var totalSpent=txs.reduce(function(s,t){return s+t.amount_usdc},0);
  var extTxs=txs.filter(function(t){return t.to_agent.indexOf('ext')>-1||t.to_agent.indexOf('designer')>-1||t.to_agent.indexOf('analyst')>-1});
  var extSpent=extTxs.reduce(function(s,t){return s+t.amount_usdc},0);
  var agentsPaid=new Set(txs.map(function(t){return t.to_agent})).size;
  document.getElementById('pay-total').textContent=txs.length;
  document.getElementById('pay-spent').textContent='$'+totalSpent.toFixed(4);
  document.getElementById('pay-external').textContent='$'+extSpent.toFixed(4);
  document.getElementById('pay-agents-paid').textContent=agentsPaid;
  document.getElementById('pay-count-label').textContent=txs.length+' transactions';

  // Spend by agent chart
  var agentSpend={};
  txs.forEach(function(t){agentSpend[t.to_agent]=(agentSpend[t.to_agent]||0)+t.amount_usdc});
  var ctx=document.getElementById('pay-spend-chart');
  if(ctx){
    if(chartInstances.paySpend)chartInstances.paySpend.destroy();
    chartInstances.paySpend=new Chart(ctx,{type:'doughnut',data:{labels:Object.keys(agentSpend),datasets:[{data:Object.values(agentSpend),backgroundColor:['#6366f1','#22c55e','#3b82f6','#eab308','#ef4444','#a855f7'],borderColor:'#1c1c22',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#a1a1aa',font:{size:11},padding:8}}}}});
  }

  // Payment table
  document.getElementById('payment-table').innerHTML='<table class="data-table"><thead><tr><th>Time</th><th>From</th><th>To</th><th>Amount</th><th>Task</th><th>Status</th></tr></thead><tbody>'+txs.map(function(t){
    var sb=t.status==='completed'?'badge-green':t.status==='pending'?'badge-yellow':'badge-muted';
    var isExt=t.to_agent.indexOf('ext')>-1||t.to_agent.indexOf('designer')>-1||t.to_agent.indexOf('analyst')>-1;
    return'<tr><td>'+fmtDate(t.timestamp)+'</td><td>'+t.from_agent+'</td><td style="color:var(--text);font-weight:500">'+t.to_agent+(isExt?' <span class="gpt4o-tag">x402</span>':'')+'</td><td style="color:var(--green);font-weight:600">$'+t.amount_usdc.toFixed(4)+'</td><td style="font-size:11px;color:var(--text-muted)">'+t.task_id+'</td><td><span class="badge '+sb+'">'+t.status+'</span></td></tr>';
  }).join('')+'</tbody></table>';
}

// ── METRICS ──
async function renderMetricsPage(){
  var stats=cachedStats||await fetchJSON('/stats');
  if(!stats)stats={};
  document.getElementById('m-total-spend').textContent='$'+(stats.total_spent_usdc||0).toFixed(2);
  document.getElementById('m-success-rate').textContent=(stats.completion_rate||0).toFixed(0)+'%';
  document.getElementById('m-avg-response').textContent=(stats.avg_response_ms||0).toFixed(0)+'ms';
  document.getElementById('m-gpt4o').textContent=stats.gpt4o_tasks||0;
  renderPerfChart();
  renderSpendChart(stats.agent_spend||{});
}
function renderPerfChart(){
  var ctx=document.getElementById('perf-chart');if(!ctx)return;if(chartInstances.perf)chartInstances.perf.destroy();
  chartInstances.perf=new Chart(ctx,{type:'radar',data:{labels:['Speed','Quality','Cost Efficiency','Reliability','Versatility'],datasets:[{label:'Builder',data:[85,92,78,96,70],borderColor:'#6366f1',backgroundColor:'rgba(99,102,241,0.15)',pointBackgroundColor:'#6366f1'},{label:'Research',data:[70,88,85,92,90],borderColor:'#22c55e',backgroundColor:'rgba(34,197,94,0.15)',pointBackgroundColor:'#22c55e'},{label:'External',data:[75,90,65,88,95],borderColor:'#eab308',backgroundColor:'rgba(234,179,8,0.15)',pointBackgroundColor:'#eab308'}]},options:{responsive:true,maintainAspectRatio:false,scales:{r:{grid:{color:'#27272a'},pointLabels:{color:'#a1a1aa',font:{size:11}},ticks:{display:false},suggestedMin:0,suggestedMax:100}},plugins:{legend:{labels:{color:'#a1a1aa',font:{size:11}}}}}});
}
function renderSpendChart(agentSpend){
  var ctx=document.getElementById('spend-by-agent-chart');if(!ctx)return;if(chartInstances.spend)chartInstances.spend.destroy();
  var labels=Object.keys(agentSpend);var values=Object.values(agentSpend);
  if(labels.length===0){labels=['builder','research','external'];values=[0.06,0.03,0.04]}
  chartInstances.spend=new Chart(ctx,{type:'doughnut',data:{labels:labels,datasets:[{data:values,backgroundColor:['#6366f1','#22c55e','#3b82f6','#eab308','#ef4444','#a855f7'],borderColor:'#1c1c22',borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{color:'#a1a1aa',font:{size:11},padding:12}}}}});
}

// ── DEMO ──
async function toggleDemo(){
  var btn=document.getElementById('demo-btn'),badge=document.getElementById('demo-badge');btn.disabled=true;
  try{if(demoRunning){await fetch(API+'/demo/stop').catch(function(){});demoRunning=false;btn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>Start Demo';badge.classList.remove('active');toast('Demo stopped','info')}
  else{await fetch(API+'/demo/seed').catch(function(){});await fetch(API+'/demo/start').catch(function(){});demoRunning=true;btn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>Stop Demo';badge.classList.add('active');toast('Demo mode activated — tasks will auto-submit every 30s','success');refreshOverview()}}
  catch(e){toast('Demo toggle error','error')}finally{btn.disabled=false}}

async function checkDemoStatus(){try{var d=await fetchJSON('/demo/status');if(d&&d.running){demoRunning=true;document.getElementById('demo-btn').innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>Stop Demo';document.getElementById('demo-badge').classList.add('active')}}catch(e){}}

// ── LIVE DEMO PIPELINE ──
var liveDemoRunning=false,liveDemoIndex=0;

function closePipeline(){document.getElementById('pipeline-overlay').classList.remove('active');}

function resetPipelineUI(){
  for(var i=1;i<=6;i++){
    var el=document.getElementById('ps-'+i);
    el.className='pipeline-stage waiting';
    document.getElementById('ps-'+i+'-detail').textContent='Waiting...';
    document.getElementById('ps-'+i+'-time').textContent='';
  }
  document.getElementById('pipeline-result').classList.remove('visible');
  document.getElementById('pipeline-again-btn').style.display='none';
  document.getElementById('pipeline-total').textContent='Starting pipeline...';
}

async function runLiveDemo(){
  if(liveDemoRunning)return;
  liveDemoRunning=true;
  var btn=document.getElementById('live-demo-btn');
  btn.disabled=true;
  btn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>Running...';

  resetPipelineUI();
  document.getElementById('pipeline-overlay').classList.add('active');
  document.getElementById('pipeline-task-text').textContent='Submitting to CEO agent...';

  // Animate stages one by one before the real call completes
  var stageNames=['Task Received','Agent Discovery','Budget Allocation','GPT-4o Execution','Payment Settlement','Result Delivered'];
  var currentStage=0;

  function activateStage(n){
    if(n>6)return;
    var el=document.getElementById('ps-'+n);
    el.className='pipeline-stage active';
  }

  // Start animating stages optimistically
  activateStage(1);

  try{
    var r=await fetch(API+'/demo/live',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({task_index:liveDemoIndex})});
    if(!r.ok)throw new Error('API error '+r.status);
    var data=await r.json();

    // Update task text
    document.getElementById('pipeline-task-text').textContent=data.description;

    // Animate through all stages with delays
    var stages=data.stages||[];
    for(var i=0;i<stages.length;i++){
      await new Promise(function(res){setTimeout(res,350)});
      var s=stages[i];
      var n=s.stage;
      // Complete previous stages
      for(var j=1;j<n;j++){
        var prev=document.getElementById('ps-'+j);
        if(prev.className.indexOf('done')<0)prev.className='pipeline-stage done';
      }
      // Activate current
      var el=document.getElementById('ps-'+n);
      el.className='pipeline-stage active';
      document.getElementById('ps-'+n+'-detail').textContent=s.detail;
      // Briefly show active then mark done
      await new Promise(function(res){setTimeout(res,300)});
      el.className='pipeline-stage done';
      document.getElementById('ps-'+n+'-time').textContent=s.duration_ms+'ms';
    }

    // Show result panel
    document.getElementById('pr-agent').textContent=data.agent;
    document.getElementById('pr-cost').textContent='$'+data.cost_usdc.toFixed(4);
    document.getElementById('pr-time').textContent=data.total_ms+'ms';
    document.getElementById('pr-model').textContent=data.model.toUpperCase();
    document.getElementById('pr-preview').textContent=data.response_preview;
    document.getElementById('pipeline-result').classList.add('visible');
    document.getElementById('pipeline-total').innerHTML='Pipeline completed in <strong>'+data.total_ms+'ms</strong> — Task ID: '+data.task_id;
    document.getElementById('pipeline-again-btn').style.display='inline-flex';

    toast('Live demo completed — '+data.agent+' finished in '+data.total_ms+'ms','success');
    liveDemoIndex=(liveDemoIndex+1)%3;

    // Refresh dashboard data
    setTimeout(refreshOverview,1000);
  }catch(e){
    toast('Live demo error: '+e.message,'error');
    document.getElementById('pipeline-total').textContent='Pipeline failed: '+e.message;
    document.getElementById('pipeline-again-btn').style.display='inline-flex';
  }finally{
    liveDemoRunning=false;
    btn.disabled=false;
    btn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>Live Demo';
  }
}

// ── APPROVALS (HITL) ──
async function renderApprovalsPage(){
  var stats=await fetchJSON('/approvals/stats');
  var pending=await fetchJSON('/approvals/pending');
  var all=await fetchJSON('/approvals/all');
  if(stats){
    document.getElementById('hitl-pending').textContent=stats.pending;
    document.getElementById('hitl-approved').textContent=stats.approved;
    document.getElementById('hitl-rejected').textContent=stats.rejected;
    document.getElementById('hitl-auto').textContent=stats.auto_approved;
    document.getElementById('nav-approval-count').textContent=stats.pending;
  }
  if(pending&&pending.length>0){
    document.getElementById('hitl-pending-list').innerHTML=pending.map(function(r){
      return'<div style="padding:12px;border-bottom:1px solid var(--border)"><div style="display:flex;justify-content:space-between;margin-bottom:6px"><span style="font-weight:600;color:var(--text)">'+r.action+'</span><span class="badge badge-yellow">pending</span></div><div style="font-size:12px;color:var(--text-muted);margin-bottom:8px">'+r.description+'</div><div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px">Cost: <strong style="color:var(--green)">$'+r.cost_usdc.toFixed(2)+' USDC</strong></div><div style="display:flex;gap:8px"><button class="btn btn-sm btn-success" onclick="approveRequest(\''+r.request_id+'\')">Approve</button><button class="btn btn-sm" style="border-color:var(--red);color:var(--red)" onclick="rejectRequest(\''+r.request_id+'\')">Reject</button></div></div>';
    }).join('');
  }else{
    document.getElementById('hitl-pending-list').innerHTML='<div class="empty-state">No pending approvals</div>';
  }
  if(all&&all.length>0){
    var html='<table class="data-table"><thead><tr><th>Action</th><th>Cost</th><th>Status</th><th>Reviewer</th><th>Time</th></tr></thead><tbody>';
    all.forEach(function(r){
      var sb=r.status==='approved'?'badge-green':r.status==='rejected'?'badge-red':r.status==='auto_approved'?'badge-blue':r.status==='pending'?'badge-yellow':'badge-muted';
      html+='<tr><td style="color:var(--text);font-weight:500">'+r.action+'</td><td style="color:var(--green)">$'+r.cost_usdc.toFixed(2)+'</td><td><span class="badge '+sb+'">'+r.status+'</span></td><td>'+r.reviewer+'</td><td>'+fmtDate(r.created_at)+'</td></tr>';
    });
    html+='</tbody></table>';
    document.getElementById('hitl-history').innerHTML=html;
  }
}
async function approveRequest(id){
  try{var r=await fetch(API+'/approvals/'+id+'/approve',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({reviewer:'dashboard_user',reason:'Approved via dashboard'})});if(r.ok){toast('Approved','success');renderApprovalsPage()}else toast('Failed','error')}catch(e){toast('Error','error')}
}
async function rejectRequest(id){
  try{var r=await fetch(API+'/approvals/'+id+'/reject',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({reviewer:'dashboard_user',reason:'Rejected via dashboard'})});if(r.ok){toast('Rejected','info');renderApprovalsPage()}else toast('Failed','error')}catch(e){toast('Error','error')}
}

// ── RESPONSIBLE AI ──
async function renderSafetyPage(){
  var status=await fetchJSON('/responsible-ai/status');
  var bias=await fetchJSON('/responsible-ai/bias-report');
  if(status){
    document.getElementById('rai-checked').textContent=status.total_checked;
    document.getElementById('rai-flagged').textContent=status.flagged;
    document.getElementById('rai-blocked').textContent=status.blocked;
    document.getElementById('rai-resumes').textContent=status.resumes_checked;
    document.getElementById('rai-postings').textContent=status.job_postings_checked;
    document.getElementById('rai-safe').textContent=status.safe;
    document.getElementById('rai-warnings').textContent=status.warnings;
    document.getElementById('rai-flag-rate').textContent=(status.flagged_rate*100).toFixed(1)+'%';
  }
  if(bias){
    document.getElementById('rai-fairness').textContent=(bias.fairness_score*100).toFixed(0)+'%';
    document.getElementById('rai-decisions').textContent=bias.total_decisions;
    document.getElementById('rai-flagged-decisions').textContent=bias.flagged_decisions;
    var indHtml='';
    Object.keys(bias.bias_indicators).forEach(function(k){
      indHtml+='<div class="detail-row"><span class="label">'+k+'</span><span class="value">'+bias.bias_indicators[k]+' indicators</span></div>';
    });
    document.getElementById('rai-bias-indicators').innerHTML=indHtml;
    var recHtml=bias.recommendations.map(function(r){return'<div style="font-size:12px;color:var(--text-secondary);padding:4px 0;border-bottom:1px solid var(--border)">'+r+'</div>'}).join('');
    document.getElementById('rai-recommendations').innerHTML=recHtml;
  }
}

// Init
refreshOverview();checkDemoStatus();
setInterval(function(){if(currentPage==='overview')refreshOverview();if(currentPage==='tasks')renderTasksPage()},5000);
</script>
</body>
</html>
